<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Animal Rescue Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Global styles for proper scrolling */
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow-x: hidden;
        }

        * {
            box-sizing: border-box;
        }

        .font-bebas { font-family: 'Bebas Neue', cursive; }
        .font-inter { font-family: 'Inter', sans-serif; }
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
        }
        .btn-primary {
            background: #059669;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
        }
        .btn-primary:hover {
            background: #047857;
        }
        .btn-secondary {
            background: #6b7280;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 14px;
        }
        .btn-secondary:hover {
            background: #4b5563;
        }
        .btn-danger {
            background: #dc2626;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 14px;
        }
        .btn-danger:hover {
            background: #b91c1c;
        }
        .btn-outline {
            background: white;
            color: #374151;
            border: 1px solid #d1d5db;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn-outline:hover {
            background: #f9fafb;
            border-color: #9ca3af;
        }
        .btn-accent {
            background: #8b5cf6;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 14px;
        }
        .btn-accent:hover {
            background: #7c3aed;
        }
        .btn-sm {
            padding: 0.25rem 0.75rem;
            font-size: 0.875rem;
            border-radius: 0.375rem;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }
        .template-card {
            transition: all 0.2s ease;
            border: 2px solid #e5e7eb;
        }
        .template-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .template-card.selected {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 24px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        .form-group {
            margin-bottom: 16px;
        }
        .form-label {
            display: block;
            margin-bottom: 4px;
            font-weight: 600;
            color: #374151;
        }
        .form-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }
        .form-input:focus {
            outline: none;
            border-color: #059669;
            box-shadow: 0 0 0 3px rgba(5, 150, 105, 0.1);
        }
        .form-textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            min-height: 100px;
            resize: vertical;
        }
        .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 12px center;
            background-repeat: no-repeat;
            background-size: 16px;
            transition: all 0.2s ease;
        }
        .form-select:focus {
            outline: none;
            border-color: #059669;
            box-shadow: 0 0 0 3px rgba(5, 150, 105, 0.1);
        }
        .form-select:hover {
            border-color: #9ca3af;
        }
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
        .error {
            color: #dc2626;
            font-size: 14px;
            margin-top: 4px;
        }
        .success {
            color: #059669;
            font-size: 14px;
            margin-top: 4px;
        }
        .animal-card {
            background: white;
            border-radius: 8px;
            padding: 16px;
            border: 1px solid #e5e7eb;
            transition: box-shadow 0.2s;
        }
        .animal-card:hover {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .animal-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
        }
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        .status-available {
            background: #d1fae5;
            color: #065f46;
        }
        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }
        .status-adopted {
            background: #dbeafe;
            color: #1e40af;
        }
        .hidden {
            display: none !important;
        }
        .sidebar-tab {
            transition: all 0.2s ease;
        }
        .sidebar-tab.active {
            background-color: #dbeafe !important;
            color: #1d4ed8 !important;
        }
        .sidebar-tab:hover:not(.active) {
            background-color: #f3f4f6;
            color: #374151;
        }
        .tab-content {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50 font-inter">
    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center">
        <div class="bg-white p-8 rounded-lg shadow-lg max-w-md w-full">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bebas uppercase text-gray-900">Admin Dashboard</h1>
                <p class="text-gray-600 mt-2">Animal Rescue Management</p>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">Organization ID</label>
                    <input type="text" id="orgId" class="form-input" value="3" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Access Code</label>
                    <input type="password" id="accessCode" class="form-input" value="demo123" required>
                </div>
                <button type="submit" class="btn-primary w-full">Login</button>
                <div id="loginError" class="error hidden mt-4"></div>
            </form>
            <div class="mt-4 p-4 bg-blue-50 rounded-lg">
                <p class="text-sm text-blue-800 font-medium mb-2"><strong>Available Organizations:</strong></p>
                <div class="space-y-1 text-xs text-blue-700">
                    <div class="flex justify-between">
                        <span>ID 3: Happy Paws Dog Rescue</span>
                        <span class="font-mono">demo123</span>
                    </div>
                    <div class="flex justify-between">
                        <span>ID 4: Furry Friends Sanctuary</span>
                        <span class="font-mono">furry456</span>
                    </div>
                    <div class="flex justify-between">
                        <span>ID 5: Paws & Hearts Rescue</span>
                        <span class="font-mono">hearts789</span>
                    </div>
                    <div class="flex justify-between">
                        <span>ID 6: Second Chance Animal Rescue</span>
                        <span class="font-mono">second123</span>
                    </div>
                    <div class="flex justify-between">
                        <span>ID 7: Loving Tails Foundation</span>
                        <span class="font-mono">tails456</span>
                    </div>
                    <div class="flex justify-between bg-gray-100 px-2 py-1 rounded">
                        <span class="font-medium">ID 8: Barkhaus Admin</span>
                        <span class="font-mono font-medium">barkhaus2024</span>
                    </div>
                    <div class="flex justify-between">
                        <span>ID 9: Mission Bay Puppy Rescue</span>
                        <span class="font-mono">mission789</span>
                    </div>
                </div>
                <p class="text-xs text-blue-600 mt-2 italic">* Barkhaus Admin can switch between all organizations</p>
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboard" class="hidden min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center">
                        <h1 class="text-2xl font-bebas uppercase text-gray-900">Happy Paws Admin</h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span class="text-sm text-gray-600">Organization ID: <span id="currentOrgId"></span></span>
                        <button id="logoutBtn" class="btn-secondary">Logout</button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Layout with Sidebar -->
        <div class="flex bg-gray-50" style="height: calc(100vh - 4rem);">
            <!-- Left Sidebar -->
            <div class="w-64 bg-white shadow-lg border-r border-gray-200 overflow-y-auto">
                <div class="p-6">
                    <div class="flex items-center justify-center mb-8">
                        <img src="/assets/svgs/happy-paws.svg" alt="Happy Paws" class="h-12 w-auto">
                    </div>
                    <nav class="space-y-2">
                        <button onclick="showDashboardTab('overview')" id="tab-overview" class="sidebar-tab active w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg bg-blue-100 text-blue-700">
                            <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
                            </svg>
                            Dashboard
                        </button>
                        <button onclick="showDashboardTab('animals')" id="tab-animals" class="sidebar-tab w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-100 hover:text-gray-900">
                            <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z"/>
                            </svg>
                            Animals
                        </button>
                        <button onclick="showDashboardTab('applications')" id="tab-applications" class="sidebar-tab w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-100 hover:text-gray-900">
                            <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a1 1 0 001 1h6a1 1 0 001-1V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"/>
                            </svg>
                            Applications
                        </button>
                        <button onclick="showDashboardTab('events')" id="tab-events" class="sidebar-tab w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-100 hover:text-gray-900">
                            <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
                            </svg>
                            Events
                        </button>
                        <button onclick="showDashboardTab('donations')" id="tab-donations" class="sidebar-tab w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-100 hover:text-gray-900">
                            <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"/>
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z" clip-rule="evenodd"/>
                            </svg>
                            Donations
                        </button>
                        <button onclick="showDashboardTab('communications')" id="tab-communications" class="sidebar-tab w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-100 hover:text-gray-900">
                            <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"/>
                            </svg>
                            Communications
                        </button>
                        <button onclick="showDashboardTab('social-media')" id="tab-social-media" class="sidebar-tab w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-100 hover:text-gray-900">
                            <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"/>
                            </svg>
                            Social Media
                        </button>
                        <button onclick="showDashboardTab('settings')" id="tab-settings" class="sidebar-tab w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-100 hover:text-gray-900">
                            <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"/>
                            </svg>
                            Settings
                        </button>
                    </nav>
                </div>
            </div>

            <!-- Main Content Area -->
            <div class="flex-1 flex flex-col">
                <!-- Top Header -->
                <header class="bg-white shadow-sm border-b border-gray-200 flex-shrink-0">
                    <div class="px-6 py-4">
                        <div class="flex justify-between items-center">
                            <div>
                                <h1 class="text-2xl font-bebas uppercase text-gray-900" id="pageTitle">Dashboard</h1>
                                <p class="text-gray-600 text-sm" id="pageSubtitle">Welcome back! Here's what's happening at your rescue.</p>
                            </div>
                            <div class="flex items-center space-x-4">
                                <span class="text-sm text-gray-600">Organization ID: <span id="currentOrgId"></span></span>
                                <button onclick="visitWebsite()" class="btn-primary mr-2">
                                    <svg class="w-4 h-4 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-2M14 4h6m0 0v6m0-6L10 14"></path>
                                    </svg>
                                    Visit Website
                                </button>
                                <button id="logoutBtn" class="btn-secondary">Logout</button>
                            </div>
                        </div>
                    </div>
                </header>

                <!-- Scrollable Content Area -->
                <main class="flex-1 overflow-y-auto p-6">

                    <!-- Dashboard Overview Tab -->
                    <div id="tab-content-overview" class="tab-content">
            <!-- Stats Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="stat-card">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600">Total Animals</p>
                            <p class="text-3xl font-bold text-gray-900 mt-2" id="totalAnimals">0</p>
                        </div>
                        <div class="text-green-600">
                            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600">Available</p>
                            <p class="text-3xl font-bold text-gray-900 mt-2" id="availableAnimals">0</p>
                        </div>
                        <div class="text-blue-600">
                            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600">Pending</p>
                            <p class="text-3xl font-bold text-gray-900 mt-2" id="pendingAnimals">0</p>
                        </div>
                        <div class="text-yellow-600">
                            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M10 2L3 7v11a2 2 0 002 2h10a2 2 0 002-2V7l-7-5z"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600">Adopted</p>
                            <p class="text-3xl font-bold text-gray-900 mt-2" id="adoptedAnimals">0</p>
                        </div>
                        <div class="text-purple-600">
                            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"/>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Animals Preview -->
            <div class="bg-white rounded-lg shadow-sm border">
                <div class="px-6 py-4 border-b border-gray-200">
                    <div class="flex justify-between items-center">
                        <h2 class="text-xl font-bebas uppercase text-gray-900">Recent Animals</h2>
                        <div class="flex items-center space-x-2">
                            <button id="addAnimalBtn" class="btn-primary">Add New Animal</button>
                            <button onclick="showDashboardTab('animals')" class="btn-secondary">View All</button>
                        </div>
                    </div>
                </div>

                <!-- Recent Animals Preview -->
                <div class="p-6">
                    <div id="recentAnimalsPreview" class="space-y-3">
                        <div class="text-center py-8 text-gray-500">Loading recent animals...</div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6">
                <div class="bg-white rounded-lg shadow p-6 text-center">
                    <div class="text-3xl mb-3">📋</div>
                    <h3 class="font-medium text-gray-900 mb-2">Applications</h3>
                    <p class="text-sm text-gray-600 mb-4">Manage adoption applications</p>
                    <button onclick="showDashboardTab('applications')" class="btn-primary w-full">View Applications</button>
                </div>
                <div class="bg-white rounded-lg shadow p-6 text-center">
                    <div class="text-3xl mb-3">📅</div>
                    <h3 class="font-medium text-gray-900 mb-2">Events</h3>
                    <p class="text-sm text-gray-600 mb-4">Plan adoption events</p>
                    <button onclick="showDashboardTab('events')" class="btn-primary w-full">Manage Events</button>
                </div>
                <div class="bg-white rounded-lg shadow p-6 text-center">
                    <div class="text-3xl mb-3">💝</div>
                    <h3 class="font-medium text-gray-900 mb-2">Donations</h3>
                    <p class="text-sm text-gray-600 mb-4">Track donations</p>
                    <button onclick="showDashboardTab('donations')" class="btn-primary w-full">View Donations</button>
                </div>
            </div>
            </div> <!-- End Dashboard Overview Tab -->

            <!-- Animals Tab -->
            <div id="tab-content-animals" class="tab-content hidden">
                <div class="bg-white rounded-lg shadow-sm border">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <div class="flex justify-between items-center">
                            <h2 class="text-xl font-bebas uppercase text-gray-900">Animals Management</h2>
                            <button id="addAnimalBtnFull" class="btn-primary">Add New Animal</button>
                        </div>
                    </div>

                    <!-- Filters -->
                    <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
                        <div class="flex flex-wrap gap-4">
                            <div>
                                <label class="form-label">Filter by Status</label>
                                <select id="statusFilterFull" class="form-select">
                                    <option value="">All Statuses</option>
                                    <option value="Available">Available</option>
                                    <option value="Pending">Pending</option>
                                    <option value="Adopted">Adopted</option>
                                </select>
                            </div>
                            <div>
                                <label class="form-label">Filter by Species</label>
                                <select id="speciesFilterFull" class="form-select">
                                    <option value="">All Species</option>
                                    <option value="dog">Dog</option>
                                    <option value="cat">Cat</option>
                                    <option value="rabbit">Rabbit</option>
                                    <option value="bird">Bird</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div>
                                <label class="form-label">Search</label>
                                <input type="text" id="searchInputFull" class="form-input" placeholder="Search by name...">
                            </div>
                            <div class="flex items-end">
                                <button id="refreshBtnFull" class="btn-secondary">Refresh</button>
                            </div>
                        </div>
                    </div>

                    <!-- Animals List -->
                    <div class="p-6">
                        <div id="loadingMessageFull" class="text-center py-8 text-gray-500">Loading animals...</div>
                        <div id="errorMessageFull" class="hidden text-center py-8 text-red-500"></div>
                        <div id="animalsListFull" class="hidden space-y-4"></div>
                        <div id="noAnimalsMessageFull" class="hidden text-center py-8 text-gray-500">No animals found.</div>
                    </div>
                </div>
            </div>

            <!-- Applications Tab -->
            <div id="tab-content-applications" class="tab-content hidden">
                <div class="bg-white rounded-lg shadow">
                    <div class="p-6 border-b border-gray-200">
                        <h2 class="text-xl font-bebas uppercase text-gray-900">Adoption Applications</h2>
                        <p class="text-gray-600 mt-1">Manage adoption applications and track the adoption process.</p>
                    </div>
                    <div class="p-6">
                        <div class="text-center py-12">
                            <div class="text-6xl mb-4">📋</div>
                            <h3 class="text-lg font-medium text-gray-900 mb-2">Applications Management</h3>
                            <p class="text-gray-500 mb-4">View and manage adoption applications from potential adopters.</p>
                            <button class="btn-primary">Coming Soon</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Events Tab -->
            <div id="tab-content-events" class="tab-content hidden">
                <div class="bg-white rounded-lg shadow">
                    <div class="p-6 border-b border-gray-200">
                        <h2 class="text-xl font-bebas uppercase text-gray-900">Events Management</h2>
                        <p class="text-gray-600 mt-1">Create and manage adoption events, fundraisers, and community activities.</p>
                    </div>
                    <div class="p-6">
                        <div class="text-center py-12">
                            <div class="text-6xl mb-4">📅</div>
                            <h3 class="text-lg font-medium text-gray-900 mb-2">Event Planning</h3>
                            <p class="text-gray-500 mb-4">Schedule adoption events, fundraisers, and volunteer activities.</p>
                            <button class="btn-primary">Coming Soon</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Donations Tab -->
            <div id="tab-content-donations" class="tab-content hidden">
                <div class="bg-white rounded-lg shadow">
                    <div class="p-6 border-b border-gray-200">
                        <h2 class="text-xl font-bebas uppercase text-gray-900">Donations Management</h2>
                        <p class="text-gray-600 mt-1">Track donations, manage donors, and generate reports.</p>
                    </div>
                    <div class="p-6">
                        <div class="text-center py-12">
                            <div class="text-6xl mb-4">💝</div>
                            <h3 class="text-lg font-medium text-gray-900 mb-2">Donation Tracking</h3>
                            <p class="text-gray-500 mb-4">Monitor incoming donations and manage donor relationships.</p>
                            <button class="btn-primary">Coming Soon</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Communications Tab -->
            <div id="tab-content-communications" class="tab-content hidden">
                <div class="bg-white rounded-lg shadow">
                    <div class="p-6 border-b border-gray-200">
                        <h2 class="text-xl font-bebas uppercase text-gray-900">Communications</h2>
                        <p class="text-gray-600 mt-1">Send emails and messages to adopters, volunteers, and supporters.</p>
                    </div>
                    <div class="p-6">
                        <div class="text-center py-12">
                            <div class="text-6xl mb-4">💬</div>
                            <h3 class="text-lg font-medium text-gray-900 mb-2">Email & Messaging</h3>
                            <p class="text-gray-500 mb-4">Communicate with your community through automated and manual messages.</p>
                            <button class="btn-primary">Coming Soon</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Social Media Tab -->
            <div id="tab-content-social-media" class="tab-content hidden">
                <div class="space-y-6">
                    <!-- Header -->
                    <div class="bg-white rounded-lg shadow">
                        <div class="p-6 border-b border-gray-200">
                            <h2 class="text-xl font-bebas uppercase text-gray-900">AI-Powered Social Media Generator</h2>
                            <p class="text-gray-600 mt-1">Create engaging social media posts using AI to promote your animals and rescue activities.</p>
                        </div>

                        <!-- Quick Stats -->
                        <div class="p-6">
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <div class="bg-blue-50 p-4 rounded-lg">
                                    <div class="text-2xl font-bold text-blue-600" id="totalPosts">0</div>
                                    <div class="text-sm text-blue-600">Total Posts</div>
                                </div>
                                <div class="bg-green-50 p-4 rounded-lg">
                                    <div class="text-2xl font-bold text-green-600" id="publishedPosts">0</div>
                                    <div class="text-sm text-green-600">Published</div>
                                </div>
                                <div class="bg-yellow-50 p-4 rounded-lg">
                                    <div class="text-2xl font-bold text-yellow-600" id="scheduledPosts">0</div>
                                    <div class="text-sm text-yellow-600">Scheduled</div>
                                </div>
                                <div class="bg-purple-50 p-4 rounded-lg">
                                    <div class="text-2xl font-bold text-purple-600" id="draftPosts">0</div>
                                    <div class="text-sm text-purple-600">Drafts</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Post Templates -->
                    <div class="bg-white rounded-lg shadow">
                        <div class="p-6 border-b border-gray-200">
                            <h3 class="text-lg font-medium text-gray-900">⚡ Quick Post Creation</h3>
                            <p class="text-sm text-gray-600 mt-1">Choose from pre-made templates for instant social media posts.</p>
                        </div>
                        <div class="p-6">
                            <!-- Template Selection -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-6">
                                <div class="template-card border rounded-lg p-4 cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition-colors" onclick="selectTemplate('new_arrival')">
                                    <div class="flex items-start justify-between">
                                        <div class="flex-1">
                                            <div class="font-medium text-gray-900 mb-1">🐕 New Arrival</div>
                                            <div class="text-sm text-gray-600">Meet {petName}! This {age} {breed} just arrived at our shelter and is looking for their forever home...</div>
                                        </div>
                                        <div class="text-blue-500 ml-2">→</div>
                                    </div>
                                </div>

                                <div class="template-card border rounded-lg p-4 cursor-pointer hover:bg-green-50 hover:border-green-300 transition-colors" onclick="selectTemplate('adoption_success')">
                                    <div class="flex items-start justify-between">
                                        <div class="flex-1">
                                            <div class="font-medium text-gray-900 mb-1">🎉 Adoption Success</div>
                                            <div class="text-sm text-gray-600">ADOPTED! We're thrilled to share that {petName} has found their perfect family...</div>
                                        </div>
                                        <div class="text-green-500 ml-2">→</div>
                                    </div>
                                </div>

                                <div class="template-card border rounded-lg p-4 cursor-pointer hover:bg-red-50 hover:border-red-300 transition-colors" onclick="selectTemplate('fundraiser')">
                                    <div class="flex items-start justify-between">
                                        <div class="flex-1">
                                            <div class="font-medium text-gray-900 mb-1">🚨 Fundraiser Push</div>
                                            <div class="text-sm text-gray-600">We need your help! Our {campaignName} campaign is at {percentage}% of our goal...</div>
                                        </div>
                                        <div class="text-red-500 ml-2">→</div>
                                    </div>
                                </div>

                                <div class="template-card border rounded-lg p-4 cursor-pointer hover:bg-purple-50 hover:border-purple-300 transition-colors" onclick="selectTemplate('volunteer_need')">
                                    <div class="flex items-start justify-between">
                                        <div class="flex-1">
                                            <div class="font-medium text-gray-900 mb-1">🙌 Volunteer Need</div>
                                            <div class="text-sm text-gray-600">We're looking for amazing volunteers like YOU! Whether you have 2 hours or 20...</div>
                                        </div>
                                        <div class="text-purple-500 ml-2">→</div>
                                    </div>
                                </div>

                                <div class="template-card border rounded-lg p-4 cursor-pointer hover:bg-yellow-50 hover:border-yellow-300 transition-colors" onclick="selectTemplate('success_story')">
                                    <div class="flex items-start justify-between">
                                        <div class="flex-1">
                                            <div class="font-medium text-gray-900 mb-1">💕 Success Story</div>
                                            <div class="text-sm text-gray-600">Success Story Alert! {petName} is living their best life with their new family...</div>
                                        </div>
                                        <div class="text-yellow-500 ml-2">→</div>
                                    </div>
                                </div>

                                <div class="template-card border rounded-lg p-4 cursor-pointer hover:bg-indigo-50 hover:border-indigo-300 transition-colors" onclick="selectTemplate('event')">
                                    <div class="flex items-start justify-between">
                                        <div class="flex-1">
                                            <div class="font-medium text-gray-900 mb-1">📅 Event Promotion</div>
                                            <div class="text-sm text-gray-600">Mark your calendars! Join us for {eventName} on {date} at {location}...</div>
                                        </div>
                                        <div class="text-indigo-500 ml-2">→</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Quick Post Form (Hidden by default) -->
                            <div id="quickPostForm" class="hidden border-t pt-6">
                                <h4 class="font-medium text-gray-900 mb-4">Create Social Media Post</h4>

                                <div class="space-y-4">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="form-label">Post Title</label>
                                            <input type="text" id="quickPostTitle" class="form-input" placeholder="Enter post title">
                                        </div>
                                        <div>
                                            <label class="form-label">Post Type</label>
                                            <select id="quickPostType" class="form-input">
                                                <option value="new_arrival">New Arrival</option>
                                                <option value="adoption_success">Adoption Success</option>
                                                <option value="fundraiser">Fundraiser Push</option>
                                                <option value="volunteer_need">Volunteer Need</option>
                                                <option value="success_story">Success Story</option>
                                                <option value="event">Event Promotion</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="form-label">Platform</label>
                                            <select id="quickPostPlatform" class="form-input">
                                                <option value="all">All Platforms</option>
                                                <option value="facebook">Facebook</option>
                                                <option value="instagram">Instagram</option>
                                                <option value="twitter">Twitter/X</option>
                                                <option value="linkedin">LinkedIn</option>
                                                <option value="tiktok">TikTok</option>
                                                <option value="youtube">YouTube</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="form-label">Select Pet (Optional)</label>
                                            <select id="quickPostPet" class="form-input">
                                                <option value="">No specific pet</option>
                                                <!-- Will be populated with animals -->
                                            </select>
                                        </div>
                                    </div>

                                    <div>
                                        <label class="form-label">Post Content</label>
                                        <textarea id="quickPostContent" class="form-input" rows="4" placeholder="Post content will appear here..."></textarea>
                                        <div class="text-xs text-gray-500 mt-1">
                                            Character count: <span id="quickPostCharCount">0</span>
                                        </div>
                                    </div>

                                    <div>
                                        <label class="form-label">Hashtags</label>
                                        <div id="quickPostHashtags" class="flex flex-wrap gap-2 mb-2">
                                            <!-- Hashtags will be added here -->
                                        </div>
                                        <div class="flex gap-2">
                                            <input type="text" id="quickHashtagInput" class="form-input flex-1" placeholder="Add hashtag and press Enter">
                                            <button type="button" onclick="addQuickHashtag()" class="btn-secondary">Add</button>
                                        </div>
                                    </div>

                                    <!-- Preview -->
                                    <div class="bg-gray-50 rounded-lg p-4">
                                        <h5 class="font-medium text-gray-900 mb-2">Preview</h5>
                                        <div class="bg-white rounded-lg p-4 border">
                                            <div class="flex items-center mb-2">
                                                <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold text-sm">HP</div>
                                                <div class="ml-2">
                                                    <div class="font-medium text-sm">Happy Paws Rescue</div>
                                                    <div class="text-xs text-gray-500">Just now</div>
                                                </div>
                                            </div>
                                            <div id="quickPostPreview" class="text-gray-800 mb-2">
                                                Select a template to see preview...
                                            </div>
                                            <div id="quickPostHashtagsPreview" class="text-blue-600 text-sm">
                                                <!-- Hashtags preview -->
                                            </div>
                                        </div>
                                    </div>

                                    <div class="flex gap-3">
                                        <button onclick="cancelQuickPost()" class="btn-outline flex-1">Cancel</button>
                                        <button onclick="saveQuickPost()" class="btn-primary flex-1">Save Post</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Content Generator -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Left Column - Generator -->
                        <div class="bg-white rounded-lg shadow">
                            <div class="p-6 border-b border-gray-200">
                                <h3 class="text-lg font-medium text-gray-900">🤖 AI Content Generator</h3>
                                <p class="text-sm text-gray-600 mt-1">Use AI to create engaging content for your social media platforms.</p>
                            </div>
                            <div class="p-6 space-y-4">
                                <!-- Post Type -->
                                <div class="form-group">
                                    <label class="form-label">Post Type</label>
                                    <select id="postType" class="form-input">
                                        <option value="new_arrival">New Animal Arrival</option>
                                        <option value="adoption_update">Adoption Success</option>
                                        <option value="fundraiser">Fundraising Campaign</option>
                                        <option value="volunteer_need">Volunteer Recruitment</option>
                                        <option value="success_story">Success Story</option>
                                        <option value="event">Event Promotion</option>
                                        <option value="general">General Post</option>
                                    </select>
                                </div>

                                <!-- Multi-Platform Selection -->
                                <div class="form-group">
                                    <label class="form-label">Select Platforms</label>
                                    <div class="grid grid-cols-2 gap-3">
                                        <label class="flex items-center space-x-2 cursor-pointer">
                                            <input type="checkbox" id="platform-facebook" class="platform-checkbox" value="facebook" onchange="togglePlatformOptions('facebook')">
                                            <span class="text-sm font-medium">Facebook</span>
                                        </label>
                                        <label class="flex items-center space-x-2 cursor-pointer">
                                            <input type="checkbox" id="platform-instagram" class="platform-checkbox" value="instagram" onchange="togglePlatformOptions('instagram')">
                                            <span class="text-sm font-medium">Instagram</span>
                                        </label>
                                        <label class="flex items-center space-x-2 cursor-pointer">
                                            <input type="checkbox" id="platform-twitter" class="platform-checkbox" value="twitter" onchange="togglePlatformOptions('twitter')">
                                            <span class="text-sm font-medium">Twitter/X</span>
                                        </label>
                                        <label class="flex items-center space-x-2 cursor-pointer">
                                            <input type="checkbox" id="platform-linkedin" class="platform-checkbox" value="linkedin" onchange="togglePlatformOptions('linkedin')">
                                            <span class="text-sm font-medium">LinkedIn</span>
                                        </label>
                                        <label class="flex items-center space-x-2 cursor-pointer">
                                            <input type="checkbox" id="platform-tiktok" class="platform-checkbox" value="tiktok" onchange="togglePlatformOptions('tiktok')">
                                            <span class="text-sm font-medium">TikTok</span>
                                        </label>
                                        <label class="flex items-center space-x-2 cursor-pointer">
                                            <input type="checkbox" id="platform-youtube" class="platform-checkbox" value="youtube" onchange="togglePlatformOptions('youtube')">
                                            <span class="text-sm font-medium">YouTube</span>
                                        </label>
                                    </div>
                                </div>

                                <!-- Platform-Specific Options -->
                                <div id="platformOptions" class="space-y-4">
                                    <!-- Facebook Options -->
                                    <div id="facebook-options" class="platform-options hidden border rounded-lg p-4 bg-blue-50">
                                        <h4 class="font-medium text-blue-800 mb-3">Facebook Options</h4>
                                        <div class="grid grid-cols-2 gap-3">
                                            <div>
                                                <label class="form-label text-sm">Content Type</label>
                                                <select id="facebook-type" class="form-input text-sm">
                                                    <option value="post">Regular Post</option>
                                                    <option value="story">Story</option>
                                                    <option value="event">Event</option>
                                                    <option value="fundraiser">Fundraiser</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label class="form-label text-sm">Audience</label>
                                                <select id="facebook-audience" class="form-input text-sm">
                                                    <option value="general">General Public</option>
                                                    <option value="adopters">Potential Adopters</option>
                                                    <option value="volunteers">Volunteers</option>
                                                    <option value="donors">Donors</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="mt-3">
                                            <label class="form-label text-sm">Custom Link</label>
                                            <input type="url" id="facebook-link" class="form-input text-sm" placeholder="https://example.com">
                                        </div>
                                    </div>

                                    <!-- Instagram Options -->
                                    <div id="instagram-options" class="platform-options hidden border rounded-lg p-4 bg-pink-50">
                                        <h4 class="font-medium text-pink-800 mb-3">Instagram Options</h4>
                                        <div class="grid grid-cols-2 gap-3">
                                            <div>
                                                <label class="form-label text-sm">Content Type</label>
                                                <select id="instagram-type" class="form-input text-sm">
                                                    <option value="post">Feed Post</option>
                                                    <option value="story">Story</option>
                                                    <option value="reel">Reel</option>
                                                    <option value="carousel">Carousel</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label class="form-label text-sm">Style</label>
                                                <select id="instagram-style" class="form-input text-sm">
                                                    <option value="aesthetic">Aesthetic</option>
                                                    <option value="candid">Candid</option>
                                                    <option value="educational">Educational</option>
                                                    <option value="emotional">Emotional</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="mt-3">
                                            <label class="form-label text-sm">Bio Link</label>
                                            <input type="url" id="instagram-link" class="form-input text-sm" placeholder="Link in bio URL">
                                        </div>
                                    </div>

                                    <!-- Twitter Options -->
                                    <div id="twitter-options" class="platform-options hidden border rounded-lg p-4 bg-blue-50">
                                        <h4 class="font-medium text-blue-800 mb-3">Twitter/X Options</h4>
                                        <div class="grid grid-cols-2 gap-3">
                                            <div>
                                                <label class="form-label text-sm">Content Type</label>
                                                <select id="twitter-type" class="form-input text-sm">
                                                    <option value="tweet">Tweet</option>
                                                    <option value="thread">Thread</option>
                                                    <option value="poll">Poll</option>
                                                    <option value="space">Space Announcement</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label class="form-label text-sm">Engagement Style</label>
                                                <select id="twitter-style" class="form-input text-sm">
                                                    <option value="conversational">Conversational</option>
                                                    <option value="news">News Style</option>
                                                    <option value="humorous">Humorous</option>
                                                    <option value="urgent">Urgent</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- LinkedIn Options -->
                                    <div id="linkedin-options" class="platform-options hidden border rounded-lg p-4 bg-blue-50">
                                        <h4 class="font-medium text-blue-800 mb-3">LinkedIn Options</h4>
                                        <div class="grid grid-cols-2 gap-3">
                                            <div>
                                                <label class="form-label text-sm">Content Type</label>
                                                <select id="linkedin-type" class="form-input text-sm">
                                                    <option value="post">Professional Post</option>
                                                    <option value="article">Article</option>
                                                    <option value="event">Event</option>
                                                    <option value="job">Job Posting</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label class="form-label text-sm">Focus</label>
                                                <select id="linkedin-focus" class="form-input text-sm">
                                                    <option value="impact">Social Impact</option>
                                                    <option value="volunteer">Volunteer Opportunities</option>
                                                    <option value="corporate">Corporate Partnerships</option>
                                                    <option value="professional">Professional Development</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- TikTok Options -->
                                    <div id="tiktok-options" class="platform-options hidden border rounded-lg p-4 bg-black text-white">
                                        <h4 class="font-medium mb-3">TikTok Options</h4>
                                        <div class="grid grid-cols-2 gap-3">
                                            <div>
                                                <label class="form-label text-sm text-gray-200">Content Type</label>
                                                <select id="tiktok-type" class="form-input text-sm bg-gray-800 text-white border-gray-600">
                                                    <option value="video">Short Video</option>
                                                    <option value="trend">Trend Participation</option>
                                                    <option value="educational">Educational</option>
                                                    <option value="behind-scenes">Behind the Scenes</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label class="form-label text-sm text-gray-200">Trend Focus</label>
                                                <select id="tiktok-trend" class="form-input text-sm bg-gray-800 text-white border-gray-600">
                                                    <option value="cute">Cute Animals</option>
                                                    <option value="rescue">Rescue Stories</option>
                                                    <option value="training">Training Tips</option>
                                                    <option value="adoption">Adoption Success</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- YouTube Options -->
                                    <div id="youtube-options" class="platform-options hidden border rounded-lg p-4 bg-red-50">
                                        <h4 class="font-medium text-red-800 mb-3">YouTube Options</h4>
                                        <div class="grid grid-cols-2 gap-3">
                                            <div>
                                                <label class="form-label text-sm">Content Type</label>
                                                <select id="youtube-type" class="form-input text-sm">
                                                    <option value="short">YouTube Short</option>
                                                    <option value="video">Regular Video</option>
                                                    <option value="live">Live Stream</option>
                                                    <option value="premiere">Premiere</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label class="form-label text-sm">Video Style</label>
                                                <select id="youtube-style" class="form-input text-sm">
                                                    <option value="documentary">Documentary</option>
                                                    <option value="vlog">Vlog Style</option>
                                                    <option value="tutorial">Tutorial</option>
                                                    <option value="story">Story Format</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Animal Selection -->
                                <div class="form-group" id="animalSelectionGroup">
                                    <label class="form-label">Select Animal (Optional)</label>
                                    <select id="selectedAnimal" class="form-input">
                                        <option value="">No specific animal</option>
                                    </select>
                                </div>

                                <!-- Tone -->
                                <div class="form-group">
                                    <label class="form-label">Tone</label>
                                    <select id="tone" class="form-input">
                                        <option value="friendly">Friendly</option>
                                        <option value="professional">Professional</option>
                                        <option value="playful">Playful</option>
                                        <option value="urgent">Urgent</option>
                                        <option value="heartwarming">Heartwarming</option>
                                    </select>
                                </div>

                                <!-- Custom Prompt -->
                                <div class="form-group" id="customPromptGroup" style="display: none;">
                                    <label class="form-label">Custom Prompt</label>
                                    <textarea id="customPrompt" class="form-input" rows="3" placeholder="Describe what you want to post about..."></textarea>
                                </div>

                                <!-- Generate Button -->
                                <button onclick="generateSocialContent()" id="generateBtn" class="btn-primary w-full">
                                    <span id="generateBtnText">🤖 Generate with AI</span>
                                    <span id="generateBtnLoading" class="hidden">⏳ Generating...</span>
                                </button>
                            </div>
                        </div>

                        <!-- Right Column - Preview -->
                        <div class="bg-white rounded-lg shadow">
                            <div class="p-6 border-b border-gray-200">
                                <h3 class="text-lg font-medium text-gray-900">Generated Content</h3>
                                <p class="text-sm text-gray-600 mt-1">Preview and edit your AI-generated post before saving.</p>
                            </div>
                            <div class="p-6 space-y-4">
                                <!-- Generated Content Display -->
                                <div id="generatedContentArea" class="hidden">
                                    <div class="form-group">
                                        <label class="form-label">Post Content</label>
                                        <textarea id="generatedContent" class="form-input" rows="6" placeholder="Generated content will appear here..."></textarea>
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">Hashtags</label>
                                        <input type="text" id="generatedHashtags" class="form-input" placeholder="Generated hashtags will appear here...">
                                    </div>

                                    <!-- Animal Images Section -->
                                    <div id="animalImagesSection" class="form-group hidden">
                                        <label class="form-label">Animal Photos</label>
                                        <div id="animalImagesGrid" class="grid grid-cols-3 gap-3 mt-2">
                                            <!-- Animal images will be populated here -->
                                        </div>
                                        <p class="text-xs text-gray-500 mt-2">Click on any image to copy its URL for social media</p>
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">AI Image Suggestion</label>
                                        <textarea id="imagePrompt" class="form-input" rows="2" placeholder="AI image suggestions will appear here..." readonly></textarea>
                                    </div>

                                    <!-- URL Shortener Section -->
                                    <div id="urlShortenerSection" class="form-group">
                                        <label class="form-label">URL Shortener & Analytics</label>
                                        <div class="grid grid-cols-3 gap-3">
                                            <input type="url" id="originalUrl" class="form-input" placeholder="Enter URL to shorten">
                                            <button onclick="shortenUrl()" class="btn-secondary">Shorten URL</button>
                                            <input type="text" id="shortenedUrl" class="form-input" placeholder="Shortened URL will appear here" readonly>
                                        </div>
                                        <div id="urlAnalytics" class="mt-2 text-xs text-gray-600 hidden">
                                            <span id="clickCount">0 clicks</span> • <span id="urlCreated">Created: --</span>
                                        </div>
                                    </div>

                                    <!-- Optimized Media Section -->
                                    <div id="optimizedMediaSection" class="form-group">
                                        <label class="form-label">Platform-Optimized Media</label>
                                        <div id="optimizedMediaGrid" class="hidden">
                                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-3">
                                                <div class="flex items-center justify-between mb-2">
                                                    <h4 class="font-medium text-blue-900">📸 Optimized Images</h4>
                                                    <span class="text-xs text-blue-700">Platform-specific sizing & formats</span>
                                                </div>
                                                <div id="optimizedMediaContainer" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                                                    <!-- Optimized images will be populated here -->
                                                </div>
                                                <p class="text-xs text-blue-600 mt-2">
                                                    💡 <strong>Tip:</strong> These images are automatically resized and formatted for optimal performance on each social media platform.
                                                </p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Platform Results Container -->
                                    <div id="platformResultsContainer" class="space-y-6">
                                        <!-- Individual platform results will be populated here -->
                                    </div>

                                    <!-- Global Action Buttons -->
                                    <div class="space-y-3 mt-6 pt-4 border-t">
                                        <div class="flex space-x-3">
                                            <button onclick="saveAllPosts('draft')" class="btn-secondary flex-1">💾 Save All as Drafts</button>
                                            <button onclick="copyAllToClipboard()" class="btn-primary flex-1">📋 Copy All Content</button>
                                            <button onclick="optimizeAllMedia()" class="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-4 py-2 rounded flex-1 hover:from-purple-700 hover:to-pink-700 transition-colors">🎨 Optimize All Media</button>
                                        </div>
                                        <div class="flex space-x-3">
                                            <button onclick="clearGeneratedContent()" class="btn-outline flex-1">🗑️ Clear All</button>
                                            <button onclick="scheduleAllPosts()" class="btn-accent flex-1">📅 Schedule Posts</button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Placeholder -->
                                <div id="contentPlaceholder" class="text-center py-12">
                                    <div class="text-6xl mb-4">🤖</div>
                                    <h4 class="text-lg font-medium text-gray-900 mb-2">AI Content Generator</h4>
                                    <p class="text-gray-500">Select your preferences and click "Generate with AI" to create engaging social media content.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Saved Posts Section -->
                    <div class="bg-white rounded-lg shadow">
                        <div class="p-6 border-b border-gray-200">
                            <h3 class="text-lg font-medium text-gray-900">Recent Posts</h3>
                            <p class="text-sm text-gray-600 mt-1">View and manage your generated social media posts.</p>
                        </div>
                        <div class="p-6">
                            <div id="socialPostsList" class="space-y-4">
                                <div class="text-center py-8 text-gray-500">
                                    <div class="text-4xl mb-2">📝</div>
                                    <p>No posts created yet. Generate your first post above!</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="tab-content-settings" class="tab-content hidden">
                <div class="space-y-6">
                    <!-- Settings Navigation -->
                    <div class="bg-white rounded-lg shadow">
                        <div class="p-6 border-b border-gray-200">
                            <h2 class="text-xl font-bebas uppercase text-gray-900">Settings</h2>
                            <p class="text-gray-600 mt-1">Configure your organization settings and website content.</p>
                        </div>
                        <div class="p-6">
                            <div class="flex flex-wrap gap-2 mb-6">
                                <button onclick="showSettingsSection('organization')" id="settings-tab-organization" class="settings-tab active px-4 py-2 text-sm font-medium rounded-lg bg-blue-100 text-blue-700">Organization</button>
                                <button onclick="showSettingsSection('branding')" id="settings-tab-branding" class="settings-tab px-4 py-2 text-sm font-medium rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200">Branding</button>
                                <button onclick="showSettingsSection('content')" id="settings-tab-content" class="settings-tab px-4 py-2 text-sm font-medium rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200">Website Content</button>
                                <button onclick="showSettingsSection('social')" id="settings-tab-social" class="settings-tab px-4 py-2 text-sm font-medium rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200">Social Media</button>
                                <button onclick="showSettingsSection('email')" id="settings-tab-email" class="settings-tab px-4 py-2 text-sm font-medium rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200">Email</button>
                                <button onclick="showSettingsSection('domain')" id="settings-tab-domain" class="settings-tab px-4 py-2 text-sm font-medium rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200">Domain</button>
                                <button onclick="showSettingsSection('animals')" id="settings-tab-animals" class="settings-tab px-4 py-2 text-sm font-medium rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200">Animal Import</button>
                            </div>

                            <!-- Organization Settings -->
                            <div id="settings-organization" class="settings-section">
                                <h3 class="text-lg font-medium text-gray-900 mb-4">Organization Information</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div class="space-y-4">
                                        <div class="form-group">
                                            <label class="form-label">Organization Name *</label>
                                            <input type="text" id="orgName" class="form-input" value="Happy Paws Dog Rescue" placeholder="Your Organization Name">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">EIN (Tax ID) *</label>
                                            <input type="text" id="orgEIN" class="form-input" placeholder="XX-XXXXXXX">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Phone Number *</label>
                                            <input type="tel" id="orgPhone" class="form-input" value="(555) 123-4567">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Main Email *</label>
                                            <input type="email" id="orgEmail" class="form-input" value="info@happypaws.org">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Description</label>
                                            <textarea id="orgDescription" class="form-textarea" rows="3" placeholder="Brief description of your organization"></textarea>
                                        </div>
                                    </div>
                                    <div class="space-y-4">
                                        <div class="form-group">
                                            <label class="form-label">Address</label>
                                            <input type="text" id="orgAddress" class="form-input" placeholder="123 Main St">
                                        </div>
                                        <div class="grid grid-cols-3 gap-4">
                                            <div class="form-group">
                                                <label class="form-label">City</label>
                                                <input type="text" id="orgCity" class="form-input" placeholder="City">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">State</label>
                                                <input type="text" id="orgState" class="form-input" placeholder="CA">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">ZIP</label>
                                                <input type="text" id="orgZip" class="form-input" placeholder="12345">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Website URL</label>
                                            <input type="url" id="orgWebsite" class="form-input" value="https://happypaws.org">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Facebook URL</label>
                                            <input type="url" id="facebookUrl" class="form-input" placeholder="https://facebook.com/yourpage">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Instagram URL</label>
                                            <input type="url" id="instagramUrl" class="form-input" placeholder="https://instagram.com/yourpage">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Twitter URL</label>
                                            <input type="url" id="twitterUrl" class="form-input" placeholder="https://twitter.com/yourpage">
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-6 space-x-4">
                                    <button onclick="saveOrganizationSettings()" class="btn-primary">Save Organization Info</button>
                                    <button onclick="testOrganizationAPI()" class="btn-secondary">Test API Connection</button>
                                </div>
                            </div>

                            <!-- Branding Settings -->
                            <div id="settings-branding" class="settings-section hidden">
                                <h3 class="text-lg font-medium text-gray-900 mb-4">Branding & Design</h3>
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                    <!-- Fonts Section -->
                                    <div class="space-y-4">
                                        <h4 class="font-medium text-gray-900">Typography</h4>
                                        <div class="form-group">
                                            <label class="form-label">Heading Font (Google Fonts)</label>
                                            <input type="text" id="headingFont" class="form-input" placeholder="Bebas Neue" value="Bebas Neue">
                                            <p class="text-xs text-gray-500 mt-1">Enter Google Font name (e.g., "Roboto", "Open Sans")</p>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Body Font (Google Fonts)</label>
                                            <input type="text" id="bodyFont" class="form-input" placeholder="Inter" value="Inter">
                                            <p class="text-xs text-gray-500 mt-1">Enter Google Font name for body text</p>
                                        </div>

                                        <!-- Color Palette -->
                                        <h4 class="font-medium text-gray-900 mt-6">Color Palette (Up to 5 colors)</h4>
                                        <div class="space-y-3">
                                            <div class="flex items-center gap-3">
                                                <input type="color" id="primaryColorPicker" class="w-12 h-10 rounded border" value="#2E8B57" onchange="updateColorText('primaryColorPicker', 'primaryColorText')">
                                                <input type="text" id="primaryColorText" class="form-input flex-1" value="#2E8B57" placeholder="Primary Color" onchange="updateColorPicker('primaryColorText', 'primaryColorPicker')">
                                                <span class="text-sm text-gray-500">Primary</span>
                                            </div>
                                            <div class="flex items-center gap-3">
                                                <input type="color" id="secondaryColorPicker" class="w-12 h-10 rounded border" value="#3CB371" onchange="updateColorText('secondaryColorPicker', 'secondaryColorText')">
                                                <input type="text" id="secondaryColorText" class="form-input flex-1" value="#3CB371" placeholder="Secondary Color" onchange="updateColorPicker('secondaryColorText', 'secondaryColorPicker')">
                                                <span class="text-sm text-gray-500">Secondary</span>
                                            </div>
                                            <div class="flex items-center gap-3">
                                                <input type="color" class="w-12 h-10 rounded border" value="#2C3E50">
                                                <input type="text" class="form-input flex-1" value="#2C3E50" placeholder="Accent Color">
                                                <span class="text-sm text-gray-500">Accent</span>
                                            </div>
                                            <div class="flex items-center gap-3">
                                                <input type="color" class="w-12 h-10 rounded border" value="#34495E">
                                                <input type="text" class="form-input flex-1" value="#34495E" placeholder="Text Color">
                                                <span class="text-sm text-gray-500">Text</span>
                                            </div>
                                            <div class="flex items-center gap-3">
                                                <input type="color" class="w-12 h-10 rounded border" value="#FFFFFF">
                                                <input type="text" class="form-input flex-1" value="#FFFFFF" placeholder="Background Color">
                                                <span class="text-sm text-gray-500">Background</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Logo Section -->
                                    <div class="space-y-4">
                                        <h4 class="font-medium text-gray-900">Logo Upload</h4>
                                        <div class="space-y-4">
                                            <div class="form-group">
                                                <label class="form-label">Logo URL</label>
                                                <input type="url" id="logoUrl" class="form-input" placeholder="https://example.com/logo.svg">
                                                <p class="text-xs text-gray-500 mt-1">Direct URL to your logo file (SVG or PNG recommended)</p>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Logo Upload (Alternative)</label>
                                                <input type="file" id="logoUpload" class="form-input" accept="image/*">
                                                <p class="text-xs text-gray-500 mt-1">Upload: SVG or PNG, 300x100px max, under 500KB</p>
                                            </div>
                                        </div>

                                        <div class="bg-blue-50 p-4 rounded-lg mt-4">
                                            <h5 class="font-medium text-blue-900 mb-2">Logo Guidelines</h5>
                                            <ul class="text-sm text-blue-800 space-y-1">
                                                <li>• SVG format preferred for scalability</li>
                                                <li>• PNG with transparent background as alternative</li>
                                                <li>• Keep file size under 500KB</li>
                                                <li>• Ensure logos are readable at small sizes</li>
                                                <li>• Test contrast on both light and dark backgrounds</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-6">
                                    <button onclick="saveBrandingSettings()" class="btn-primary">Save Branding Settings</button>
                                </div>
                            </div>

                            <!-- Website Content Settings -->
                            <div id="settings-content" class="settings-section hidden">
                                <h3 class="text-lg font-medium text-gray-900 mb-4">Website Content Management</h3>

                                <!-- Hero Section -->
                                <div class="bg-gray-50 p-6 rounded-lg mb-6">
                                    <h4 class="font-medium text-gray-900 mb-4">Hero Section</h4>
                                    <div class="space-y-4">
                                        <div class="form-group">
                                            <label class="form-label">Main Heading *</label>
                                            <input type="text" class="form-input" placeholder="Find Your Perfect Companion" value="Find Your Perfect Companion">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Subheading *</label>
                                            <textarea class="form-input" rows="2" placeholder="Every animal deserves a loving home. Browse our available pets and find your new best friend today.">Every animal deserves a loving home. Browse our available pets and find your new best friend today.</textarea>
                                        </div>
                                    </div>
                                </div>

                                <!-- Services Section -->
                                <div class="bg-gray-50 p-6 rounded-lg mb-6">
                                    <h4 class="font-medium text-gray-900 mb-4">Top 3 Services</h4>
                                    <div class="space-y-4">
                                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                            <div class="form-group">
                                                <label class="form-label">Service 1 *</label>
                                                <input type="text" class="form-input" placeholder="Pet Adoption" value="Pet Adoption">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Service 2 *</label>
                                                <input type="text" class="form-input" placeholder="Foster Care" value="Foster Care">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Service 3 *</label>
                                                <input type="text" class="form-input" placeholder="Volunteer Programs" value="Volunteer Programs">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- About Section -->
                                <div class="bg-gray-50 p-6 rounded-lg mb-6">
                                    <h4 class="font-medium text-gray-900 mb-4">About Us</h4>
                                    <div class="space-y-4">
                                        <div class="form-group">
                                            <label class="form-label">About Us *</label>
                                            <textarea id="aboutUsContent" class="form-input" rows="4" placeholder="We are a dedicated team of animal lovers committed to rescuing, rehabilitating, and rehoming animals in need...">We are a dedicated team of animal lovers committed to rescuing, rehabilitating, and rehoming animals in need...</textarea>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Mission Statement *</label>
                                            <textarea id="missionContent" class="form-input" rows="3" placeholder="Our mission is to provide temporary shelter, medical care, and love to abandoned and surrendered animals...">Our mission is to provide temporary shelter, medical care, and love to abandoned and surrendered animals...</textarea>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Vision Statement</label>
                                            <textarea id="visionContent" class="form-input" rows="3" placeholder="We envision a world where every animal has a loving home...">We envision a world where every animal has a loving home...</textarea>
                                        </div>
                                    </div>
                                </div>

                                <!-- FAQ Section -->
                                <div class="bg-gray-50 p-6 rounded-lg mb-6">
                                    <h4 class="font-medium text-gray-900 mb-4">Frequently Asked Questions</h4>
                                    <div class="space-y-4">
                                        <div class="border border-gray-200 rounded-lg p-4 bg-white">
                                            <div class="form-group">
                                                <label class="form-label">FAQ 1 - Question</label>
                                                <input type="text" class="form-input" placeholder="What is the adoption process?" value="What is the adoption process?">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">FAQ 1 - Answer</label>
                                                <textarea class="form-input" rows="3" placeholder="Our adoption process includes...">Our adoption process includes an application, meet and greet, home visit, and adoption fee.</textarea>
                                            </div>
                                        </div>
                                        <div class="border border-gray-200 rounded-lg p-4 bg-white">
                                            <div class="form-group">
                                                <label class="form-label">FAQ 2 - Question</label>
                                                <input type="text" class="form-input" placeholder="What are the adoption fees?" value="What are the adoption fees?">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">FAQ 2 - Answer</label>
                                                <textarea class="form-input" rows="3" placeholder="Adoption fees vary by animal...">Adoption fees vary by animal type and include spaying/neutering, vaccinations, and microchipping.</textarea>
                                            </div>
                                        </div>
                                        <div class="border border-gray-200 rounded-lg p-4 bg-white">
                                            <div class="form-group">
                                                <label class="form-label">FAQ 3 - Question</label>
                                                <input type="text" class="form-input" placeholder="Can I volunteer?" value="Can I volunteer?">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">FAQ 3 - Answer</label>
                                                <textarea class="form-input" rows="3" placeholder="Yes! We welcome volunteers...">Yes! We welcome volunteers for various activities including dog walking, cat socialization, and administrative tasks.</textarea>
                                            </div>
                                        </div>
                                        <button class="btn-secondary" onclick="addNewFAQ()">Add Another FAQ</button>
                                    </div>
                                </div>

                                <div class="mt-6">
                                    <button class="btn-primary" onclick="saveWebsiteContent()">Save Website Content</button>
                                </div>
                            </div>

                            <!-- Social Media Settings -->
                            <div id="settings-social" class="settings-section hidden">
                                <h3 class="text-lg font-medium text-gray-900 mb-4">Social Media Integration</h3>

                                <div class="bg-gray-50 p-6 rounded-lg mb-6">
                                    <h4 class="font-medium text-gray-900 mb-4">Social Media Accounts</h4>
                                    <div class="space-y-4">
                                        <div class="form-group">
                                            <label class="form-label">
                                                <svg class="w-5 h-5 inline mr-2" fill="currentColor" viewBox="0 0 24 24">
                                                    <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                                                </svg>
                                                Instagram URL
                                            </label>
                                            <input type="url" id="instagramUrl" class="form-input" placeholder="https://instagram.com/yourrescue" value="">
                                            <p class="text-xs text-gray-500 mt-1">Your Instagram profile URL</p>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">
                                                <svg class="w-5 h-5 inline mr-2" fill="currentColor" viewBox="0 0 24 24">
                                                    <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                                                </svg>
                                                Facebook URL
                                            </label>
                                            <input type="url" id="facebookUrl" class="form-input" placeholder="https://facebook.com/yourrescue" value="">
                                            <p class="text-xs text-gray-500 mt-1">Your Facebook page URL</p>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">
                                                <svg class="w-5 h-5 inline mr-2" fill="currentColor" viewBox="0 0 24 24">
                                                    <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
                                                </svg>
                                                Twitter URL
                                            </label>
                                            <input type="url" id="twitterUrl" class="form-input" placeholder="https://twitter.com/yourrescue" value="">
                                            <p class="text-xs text-gray-500 mt-1">Your Twitter profile URL</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-blue-50 p-4 rounded-lg mb-6">
                                    <h5 class="font-medium text-blue-900 mb-2">Social Media Tips</h5>
                                    <ul class="text-sm text-blue-800 space-y-1">
                                        <li>• Share adoption success stories to build trust</li>
                                        <li>• Post regular updates about available animals</li>
                                        <li>• Use hashtags like #AdoptDontShop #RescueDogs</li>
                                        <li>• Engage with your community and other rescues</li>
                                        <li>• Share behind-the-scenes content of your work</li>
                                    </ul>
                                </div>

                                <div class="mt-6">
                                    <button onclick="saveSocialMediaSettings()" class="btn-primary">Save Social Media Settings</button>
                                </div>
                            </div>

                            <!-- Email Settings -->
                            <div id="settings-email" class="settings-section hidden">
                                <h3 class="text-lg font-medium text-gray-900 mb-4">Email Integration</h3>

                                <div class="bg-gray-50 p-6 rounded-lg mb-6">
                                    <h4 class="font-medium text-gray-900 mb-4">Email Service Provider</h4>
                                    <div class="space-y-4">
                                        <div class="form-group">
                                            <label class="form-label">Email Provider</label>
                                            <select id="emailProvider" class="form-select">
                                                <option value="">Select Email Provider</option>
                                                <option value="gmail">Gmail</option>
                                                <option value="outlook">Outlook/Hotmail</option>
                                                <option value="yahoo">Yahoo Mail</option>
                                                <option value="mailchimp">Mailchimp</option>
                                                <option value="constantcontact">Constant Contact</option>
                                                <option value="sendgrid">SendGrid</option>
                                                <option value="other">Other</option>
                                            </select>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">Primary Email Address *</label>
                                            <input type="email" id="primaryEmail" class="form-input" placeholder="info@yourrescue.org" value="">
                                            <p class="text-xs text-gray-500 mt-1">This email will appear in the Communications section</p>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">SMTP Server (if applicable)</label>
                                            <input type="text" id="smtpServer" class="form-input" placeholder="smtp.gmail.com" value="">
                                        </div>

                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div class="form-group">
                                                <label class="form-label">SMTP Port</label>
                                                <input type="number" id="smtpPort" class="form-input" placeholder="587" value="">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Security</label>
                                                <select id="smtpSecurity" class="form-select">
                                                    <option value="tls">TLS</option>
                                                    <option value="ssl">SSL</option>
                                                    <option value="none">None</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-yellow-50 p-4 rounded-lg mb-6">
                                    <h5 class="font-medium text-yellow-900 mb-2">⚠️ Security Notice</h5>
                                    <p class="text-sm text-yellow-800">We recommend using app-specific passwords or OAuth for email integration. Never share your main email password.</p>
                                </div>

                                <div class="mt-6">
                                    <button onclick="saveEmailSettings()" class="btn-primary">Save Email Settings</button>
                                </div>
                            </div>

                            <!-- Domain Settings -->
                            <div id="settings-domain" class="settings-section hidden">
                                <h3 class="text-lg font-medium text-gray-900 mb-4">Domain Management</h3>

                                <div class="bg-gray-50 p-6 rounded-lg mb-6">
                                    <h4 class="font-medium text-gray-900 mb-4">Domain Provider Information</h4>
                                    <div class="space-y-4">
                                        <div class="form-group">
                                            <label class="form-label">Domain Provider</label>
                                            <select id="domainProvider" class="form-select">
                                                <option value="">Select Domain Provider</option>
                                                <option value="godaddy">GoDaddy</option>
                                                <option value="namecheap">Namecheap</option>
                                                <option value="bluehost">Bluehost</option>
                                                <option value="hostgator">HostGator</option>
                                                <option value="siteground">SiteGround</option>
                                                <option value="cloudflare">Cloudflare</option>
                                                <option value="google">Google Domains</option>
                                                <option value="squarespace">Squarespace</option>
                                                <option value="wix">Wix</option>
                                                <option value="wordpress">WordPress.com</option>
                                                <option value="other">Other</option>
                                            </select>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">Domain Name *</label>
                                            <input type="text" id="domainName" class="form-input" placeholder="yourrescue.org" value="">
                                            <p class="text-xs text-gray-500 mt-1">Your website domain (without https://)</p>
                                        </div>

                                        <div class="form-group">
                                            <label class="form-label">Provider Login URL</label>
                                            <input type="url" id="providerLoginUrl" class="form-input" placeholder="https://account.godaddy.com" value="">
                                            <p class="text-xs text-gray-500 mt-1">URL where you log into your domain provider</p>
                                        </div>

                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div class="form-group">
                                                <label class="form-label">Account Username/Email</label>
                                                <input type="text" id="domainUsername" class="form-input" placeholder="your-username" value="">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Account ID (if applicable)</label>
                                                <input type="text" id="domainAccountId" class="form-input" placeholder="Account ID" value="">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-blue-50 p-4 rounded-lg mb-6">
                                    <h5 class="font-medium text-blue-900 mb-2">🔒 Security & Privacy</h5>
                                    <ul class="text-sm text-blue-800 space-y-1">
                                        <li>• We will never store your passwords</li>
                                        <li>• This information helps us assist with domain setup</li>
                                        <li>• You maintain full control of your domain</li>
                                        <li>• We recommend enabling two-factor authentication</li>
                                    </ul>
                                </div>

                                <div class="bg-green-50 p-4 rounded-lg mb-6">
                                    <h5 class="font-medium text-green-900 mb-2">✅ What We Can Help With</h5>
                                    <ul class="text-sm text-green-800 space-y-1">
                                        <li>• DNS configuration for your website</li>
                                        <li>• SSL certificate setup</li>
                                        <li>• Email forwarding configuration</li>
                                        <li>• Subdomain setup (www, admin, etc.)</li>
                                    </ul>
                                </div>

                                <div class="mt-6">
                                    <button onclick="saveDomainSettings()" class="btn-primary">Save Domain Settings</button>
                                </div>
                            </div>

                            <!-- Animal Import Settings -->
                            <div id="settings-animals" class="settings-section hidden">
                                <h3 class="text-lg font-medium text-gray-900 mb-4">Animal Data Import</h3>

                                <!-- CSV Upload -->
                                <div class="bg-gray-50 p-6 rounded-lg mb-6">
                                    <h4 class="font-medium text-gray-900 mb-4">Upload Animals via CSV</h4>
                                    <div class="space-y-4">
                                        <div class="form-group">
                                            <label class="form-label">CSV File *</label>
                                            <input type="file" id="csvUpload" class="form-input" accept=".csv" onchange="handleCSVUpload(event)">
                                            <p class="text-xs text-gray-500 mt-1">Upload a CSV file with animal data. Maximum file size: 5MB</p>
                                        </div>

                                        <div class="bg-blue-50 p-4 rounded-lg">
                                            <h5 class="font-medium text-blue-900 mb-2">CSV Format Requirements</h5>
                                            <p class="text-sm text-blue-800 mb-2">Your CSV file should include the following columns (in any order):</p>
                                            <div class="text-xs text-blue-700 grid grid-cols-2 gap-2">
                                                <div>• name (required)</div>
                                                <div>• species (required)</div>
                                                <div>• breed</div>
                                                <div>• age</div>
                                                <div>• gender</div>
                                                <div>• size</div>
                                                <div>• status (Available/Pending/Adopted)</div>
                                                <div>• description</div>
                                                <div>• special_needs (true/false)</div>
                                                <div>• good_with_kids (true/false)</div>
                                                <div>• good_with_cats (true/false)</div>
                                                <div>• good_with_dogs (true/false)</div>
                                                <div>• spayed_neutered (true/false)</div>
                                                <div>• vaccinated (true/false)</div>
                                                <div>• microchip (true/false)</div>
                                                <div>• image_url</div>
                                            </div>
                                        </div>

                                        <div class="flex gap-4">
                                            <button class="btn-secondary" onclick="downloadCSVTemplate()">Download Template</button>
                                            <button class="btn-primary" onclick="processCSVUpload()" disabled id="processCSVBtn">Process Upload</button>
                                        </div>

                                        <div id="csvPreview" class="hidden mt-4">
                                            <h5 class="font-medium text-gray-900 mb-2">Preview (First 5 rows)</h5>
                                            <div class="overflow-x-auto">
                                                <table class="min-w-full border border-gray-200 rounded-lg">
                                                    <thead id="csvHeaders" class="bg-gray-50"></thead>
                                                    <tbody id="csvData"></tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="mt-6">
                                    <button class="btn-primary">Save Import Settings</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

                </main>
            </div>
        </div>

    <!-- Add/Edit Animal Modal -->
    <div id="animalModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bebas uppercase text-gray-900" id="modalTitle">Add New Animal</h3>
                <button id="closeModalBtn" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"/>
                    </svg>
                </button>
            </div>

            <form id="animalForm">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="form-group">
                        <label class="form-label">Name *</label>
                        <input type="text" id="animalName" class="form-input" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Species *</label>
                        <select id="animalSpecies" class="form-select" required>
                            <option value="">Select Species</option>
                            <option value="dog">Dog</option>
                            <option value="cat">Cat</option>
                            <option value="rabbit">Rabbit</option>
                            <option value="bird">Bird</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Breed</label>
                        <input type="text" id="animalBreed" class="form-input">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Age</label>
                        <input type="number" id="animalAge" class="form-input" min="0">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Gender</label>
                        <select id="animalGender" class="form-select">
                            <option value="">Select Gender</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Size</label>
                        <select id="animalSize" class="form-select">
                            <option value="">Select Size</option>
                            <option value="Small">Small</option>
                            <option value="Medium">Medium</option>
                            <option value="Large">Large</option>
                            <option value="Extra Large">Extra Large</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Weight</label>
                        <input type="text" id="animalWeight" class="form-input" placeholder="e.g., 25 lbs">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Status *</label>
                        <select id="animalStatus" class="form-select" required>
                            <option value="">Select Status</option>
                            <option value="Available">Available</option>
                            <option value="Pending">Pending</option>
                            <option value="Adopted">Adopted</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Intake Date</label>
                        <input type="date" id="animalIntakeDate" class="form-input">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Adoption Fee</label>
                        <input type="number" id="animalAdoptionFee" class="form-input" min="0" step="0.01">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Images (<span id="imageCount">0</span>/5)</label>
                    <div class="space-y-3">
                        <!-- Image Upload Area -->
                        <div id="imageUploadArea" class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer hover:border-gray-400 transition-colors">
                            <div class="flex flex-col items-center">
                                <svg class="w-8 h-8 mb-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                </svg>
                                <p class="mb-2 text-sm text-gray-500">
                                    <span class="font-semibold">Click to upload</span> or drag and drop
                                </p>
                                <p class="text-xs text-gray-500">PNG, JPG or GIF (Max 5MB each, up to 5 images)</p>
                                <p class="text-xs text-gray-400 mt-1">First image will be the main photo</p>
                            </div>
                            <input type="file" id="imageFileInput" class="hidden" accept="image/*" multiple>
                        </div>

                        <!-- Image Preview Grid -->
                        <div id="imagePreviewGrid" class="hidden">
                            <p class="text-xs text-gray-600 mb-2">Drag images to reorder. First image is the main photo.</p>
                            <div id="imagePreviewContainer" class="grid grid-cols-5 gap-2"></div>
                        </div>

                        <!-- Fallback URL Input -->
                        <div class="border-t pt-3">
                            <label class="form-label text-sm">Or enter image URL</label>
                            <input type="url" id="animalImageUrl" class="form-input" placeholder="https://example.com/image.jpg">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea id="animalDescription" class="form-textarea" placeholder="Tell us about this animal..."></textarea>
                </div>

                <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-6">
                    <div class="checkbox-group">
                        <input type="checkbox" id="animalSpecialNeeds">
                        <label for="animalSpecialNeeds" class="text-sm">Special Needs</label>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" id="animalGoodWithKids">
                        <label for="animalGoodWithKids" class="text-sm">Good with Kids</label>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" id="animalGoodWithCats">
                        <label for="animalGoodWithCats" class="text-sm">Good with Cats</label>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" id="animalGoodWithDogs">
                        <label for="animalGoodWithDogs" class="text-sm">Good with Dogs</label>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" id="animalSpayedNeutered">
                        <label for="animalSpayedNeutered" class="text-sm">Spayed/Neutered</label>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" id="animalVaccinated">
                        <label for="animalVaccinated" class="text-sm">Vaccinated</label>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" id="animalMicrochip">
                        <label for="animalMicrochip" class="text-sm">Microchipped</label>
                    </div>
                </div>

                <div class="flex justify-end space-x-4">
                    <button type="button" id="cancelBtn" class="btn-secondary">Cancel</button>
                    <button type="submit" id="saveBtn" class="btn-primary">Save Animal</button>
                </div>

                <div id="formError" class="error hidden mt-4"></div>
                <div id="formSuccess" class="success hidden mt-4"></div>
            </form>
        </div>
    </div>

    <script>
        // Global variables
        let currentOrgId = null;
        let animals = [];
        let editingAnimalId = null;

        // DOM elements
        const loginScreen = document.getElementById('loginScreen');
        const dashboard = document.getElementById('dashboard');
        const loginForm = document.getElementById('loginForm');
        const loginError = document.getElementById('loginError');
        const logoutBtn = document.getElementById('logoutBtn');
        const currentOrgIdSpan = document.getElementById('currentOrgId');

        // Stats elements
        const totalAnimalsEl = document.getElementById('totalAnimals');
        const availableAnimalsEl = document.getElementById('availableAnimals');
        const pendingAnimalsEl = document.getElementById('pendingAnimals');
        const adoptedAnimalsEl = document.getElementById('adoptedAnimals');

        // Animals list elements
        const loadingMessage = document.getElementById('loadingMessage');
        const errorMessage = document.getElementById('errorMessage');
        const animalsList = document.getElementById('animalsList');
        const noAnimalsMessage = document.getElementById('noAnimalsMessage');

        // Filter elements
        const statusFilter = document.getElementById('statusFilter');
        const speciesFilter = document.getElementById('speciesFilter');
        const searchInput = document.getElementById('searchInput');
        const refreshBtn = document.getElementById('refreshBtn');

        // Modal elements
        const animalModal = document.getElementById('animalModal');
        const modalTitle = document.getElementById('modalTitle');
        const animalForm = document.getElementById('animalForm');
        const addAnimalBtn = document.getElementById('addAnimalBtn');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const cancelBtn = document.getElementById('cancelBtn');
        const saveBtn = document.getElementById('saveBtn');
        const formError = document.getElementById('formError');
        const formSuccess = document.getElementById('formSuccess');

        // Event listeners will be set up in DOMContentLoaded

        // Organization configurations - will be loaded from Xano
        let organizations = {
            // Fallback data while loading from Xano
            3: {
                name: "Happy Paws Dog Rescue",
                accessCode: "demo123",
                logo: "/assets/svgs/happy-paws.svg",
                colors: {
                    primary: "#059669",
                    secondary: "#6b7280"
                },
                contact: {
                    email: "info@happypaws.org",
                    phone: "(555) 123-4567",
                    address: "123 Rescue Lane, Pet City, PC 12345"
                },
                social: {
                    facebook: "https://facebook.com/happypaws",
                    instagram: "https://instagram.com/happypaws",
                    twitter: "https://twitter.com/happypaws"
                }
            },
            4: {
                name: "Furry Friends Sanctuary",
                accessCode: "furry456",
                logo: "/assets/svgs/furry-friends.svg",
                colors: {
                    primary: "#7c3aed",
                    secondary: "#a855f7"
                },
                contact: {
                    email: "hello@furryfriends.org",
                    phone: "(555) 234-5678",
                    address: "456 Animal Ave, Sanctuary City, SC 23456"
                },
                social: {
                    facebook: "https://facebook.com/furryfriends",
                    instagram: "https://instagram.com/furryfriends",
                    twitter: "https://twitter.com/furryfriends"
                }
            },
            5: {
                name: "Paws & Hearts Rescue",
                accessCode: "hearts789",
                logo: "/assets/svgs/paws-hearts.svg",
                colors: {
                    primary: "#dc2626",
                    secondary: "#ef4444"
                },
                contact: {
                    email: "contact@pawshearts.org",
                    phone: "(555) 345-6789",
                    address: "789 Heart Street, Love City, LC 34567"
                },
                social: {
                    facebook: "https://facebook.com/pawshearts",
                    instagram: "https://instagram.com/pawshearts",
                    twitter: "https://twitter.com/pawshearts"
                }
            },
            6: {
                name: "Second Chance Animal Rescue",
                accessCode: "second123",
                logo: "/assets/svgs/second-chance.svg",
                colors: {
                    primary: "#0891b2",
                    secondary: "#06b6d4"
                },
                contact: {
                    email: "info@secondchance.org",
                    phone: "(555) 456-7890",
                    address: "321 Hope Boulevard, Chance City, CC 45678"
                },
                social: {
                    facebook: "https://facebook.com/secondchance",
                    instagram: "https://instagram.com/secondchance",
                    twitter: "https://twitter.com/secondchance"
                }
            },
            7: {
                name: "Loving Tails Foundation",
                accessCode: "tails456",
                logo: "/assets/svgs/loving-tails.svg",
                colors: {
                    primary: "#ea580c",
                    secondary: "#fb923c"
                },
                contact: {
                    email: "support@lovingtails.org",
                    phone: "(555) 567-8901",
                    address: "654 Tail Way, Foundation City, FC 56789"
                },
                social: {
                    facebook: "https://facebook.com/lovingtails",
                    instagram: "https://instagram.com/lovingtails",
                    twitter: "https://twitter.com/lovingtails"
                }
            },
            8: {
                name: "Barkhaus Admin",
                accessCode: "barkhaus2024",
                logo: "/assets/svgs/barkhaus.svg",
                colors: {
                    primary: "#1f2937",
                    secondary: "#374151"
                },
                contact: {
                    email: "admin@barkhaus.com",
                    phone: "(555) 678-9012",
                    address: "987 Admin Plaza, Control City, CC 67890"
                },
                social: {
                    facebook: "https://facebook.com/barkhaus",
                    instagram: "https://instagram.com/barkhaus",
                    twitter: "https://twitter.com/barkhaus"
                },
                isAdmin: true
            },
            9: {
                name: "Mission Bay Puppy Rescue",
                accessCode: "mission789",
                logo: "/assets/svgs/mission-bay.svg",
                colors: {
                    primary: "#0ea5e9",
                    secondary: "#38bdf8"
                },
                contact: {
                    email: "info@missionbaypuppyrescue.org",
                    phone: "(619) 555-0123",
                    address: "123 Bay View Dr, San Diego, CA 92109"
                },
                social: {
                    facebook: "https://facebook.com/missionbaypuppyrescue",
                    instagram: "https://instagram.com/missionbaypuppyrescue",
                    twitter: "https://twitter.com/missionbayrescue"
                }
            }
        };

        let currentOrg = null;

        // Load organizations from Xano
        async function loadOrganizationsFromXano() {
            try {
                // Load multiple organizations (3-9)
                const orgIds = [3, 4, 5, 6, 7, 8, 9];
                const orgPromises = orgIds.map(async (id) => {
                    try {
                        const response = await fetch(`/api/admin/organization?orgId=${id}`);
                        if (response.ok) {
                            const orgData = await response.json();
                            return {
                                id: id,
                                data: {
                                    name: orgData.name || `Organization ${id}`,
                                    accessCode: getAccessCodeForOrg(id),
                                    logo: orgData.logo || "/assets/svgs/default-logo.svg",
                                    colors: {
                                        primary: orgData.primary_color || "#059669",
                                        secondary: orgData.secondary_color || "#6b7280"
                                    },
                                    contact: {
                                        email: orgData.email || `org${id}@example.com`,
                                        phone: orgData.phone || "(555) 123-4567",
                                        address: orgData.address || "123 Main St, City, State 12345"
                                    },
                                    social: {
                                        facebook: orgData.facebook_url || "",
                                        instagram: orgData.instagram_url || "",
                                        twitter: orgData.twitter_url || ""
                                    },
                                    isAdmin: id === 8
                                }
                            };
                        }
                    } catch (error) {
                        console.warn(`Failed to load organization ${id}:`, error);
                        return null;
                    }
                });

                const results = await Promise.all(orgPromises);

                // Update organizations object with real data
                results.forEach(result => {
                    if (result) {
                        organizations[result.id] = result.data;
                    }
                });

                console.log('✅ Loaded organizations from Xano:', Object.keys(organizations));
                updateLoginScreenWithOrgs();

            } catch (error) {
                console.error('Error loading organizations from Xano:', error);
                // Keep using fallback data
            }
        }

        // Get access code for organization (demo purposes)
        function getAccessCodeForOrg(id) {
            const codes = {
                3: "demo123",
                4: "furry456",
                5: "hearts789",
                6: "second123",
                7: "tails456",
                8: "barkhaus2024",
                9: "rangers789"
            };
            return codes[id] || "demo123";
        }

        // Update login screen with real organization data
        function updateLoginScreenWithOrgs() {
            const credentialsDiv = document.querySelector('.bg-blue-50');
            if (credentialsDiv && Object.keys(organizations).length > 1) {
                let credentialsHTML = '<p class="text-sm text-blue-800 font-medium mb-2"><strong>Available Organizations:</strong></p><div class="space-y-1 text-xs text-blue-700">';

                Object.entries(organizations).forEach(([id, org]) => {
                    const isAdmin = org.isAdmin ? 'bg-gray-100 px-2 py-1 rounded' : '';
                    credentialsHTML += `
                        <div class="flex justify-between ${isAdmin}">
                            <span ${org.isAdmin ? 'class="font-medium"' : ''}>ID ${id}: ${org.name}</span>
                            <span class="font-mono ${org.isAdmin ? 'font-medium' : ''}">${org.accessCode}</span>
                        </div>
                    `;
                });

                credentialsHTML += '</div><p class="text-xs text-blue-600 mt-2 italic">* Barkhaus Admin can switch between all organizations</p>';
                credentialsDiv.innerHTML = credentialsHTML;
            }
        }

        // Login handling
        async function handleLogin(e) {
            e.preventDefault();

            const orgId = document.getElementById('orgId').value;
            const accessCode = document.getElementById('accessCode').value;

            // Check if organization exists and credentials match
            const org = organizations[orgId];
            if (org && accessCode === org.accessCode) {
                currentOrg = org;
                currentOrgId = orgId;

                // Apply organization branding
                applyOrganizationBranding(orgId);

                // Update displays
                currentOrgIdSpan.textContent = orgId;

                // Show admin controls if Barkhaus admin
                if (org.isAdmin) {
                    showAdminControls();
                }

                loginScreen.classList.add('hidden');
                dashboard.classList.remove('hidden');

                // Load animals preview for dashboard
                await loadAnimalsPreview();
            } else {
                showLoginError('Invalid organization ID or access code');
            }
        }

        // Apply organization branding
        function applyOrganizationBranding(orgId) {
            const org = organizations[orgId];
            if (!org) return;

            // Update organization name in header
            const headerTitle = document.querySelector('header h1');
            if (headerTitle) {
                headerTitle.textContent = `${org.name} Admin`;
            }

            // Update page titles
            const pageTitle = document.getElementById('pageTitle');
            if (pageTitle) {
                pageTitle.textContent = org.name;
            }

            // Update logo if element exists
            const logoImg = document.querySelector('img[alt="Happy Paws"]');
            if (logoImg) {
                logoImg.src = org.logo;
                logoImg.alt = org.name;
            }

            // Apply color scheme
            const root = document.documentElement;
            root.style.setProperty('--primary-color', org.colors.primary);
            root.style.setProperty('--secondary-color', org.colors.secondary);

            // Update CSS custom properties for buttons
            const style = document.createElement('style');
            style.textContent = `
                .btn-primary {
                    background: ${org.colors.primary} !important;
                }
                .btn-primary:hover {
                    background: ${adjustColor(org.colors.primary, -20)} !important;
                }
                .sidebar-tab.active {
                    background-color: ${adjustColor(org.colors.primary, 80)} !important;
                    color: ${org.colors.primary} !important;
                }
            `;
            document.head.appendChild(style);

            // Update organization info in settings
            updateOrganizationSettings(org);
        }

        // Helper function to adjust color brightness
        function adjustColor(color, amount) {
            const usePound = color[0] === '#';
            const col = usePound ? color.slice(1) : color;
            const num = parseInt(col, 16);
            let r = (num >> 16) + amount;
            let g = (num >> 8 & 0x00FF) + amount;
            let b = (num & 0x0000FF) + amount;
            r = r > 255 ? 255 : r < 0 ? 0 : r;
            g = g > 255 ? 255 : g < 0 ? 0 : g;
            b = b > 255 ? 255 : b < 0 ? 0 : b;
            return (usePound ? '#' : '') + (r << 16 | g << 8 | b).toString(16).padStart(6, '0');
        }

        // Update organization settings form
        function updateOrganizationSettings(org) {
            // Update organization info fields if they exist
            const orgNameField = document.getElementById('orgName');
            const orgEmailField = document.getElementById('orgEmail');
            const orgPhoneField = document.getElementById('orgPhone');
            const orgAddressField = document.getElementById('orgAddress');

            if (orgNameField) orgNameField.value = org.name;
            if (orgEmailField) orgEmailField.value = org.contact.email;
            if (orgPhoneField) orgPhoneField.value = org.contact.phone;
            if (orgAddressField) orgAddressField.value = org.contact.address;

            // Update social media fields
            const facebookField = document.getElementById('facebookUrl');
            const instagramField = document.getElementById('instagramUrl');
            const twitterField = document.getElementById('twitterUrl');

            if (facebookField) facebookField.value = org.social.facebook;
            if (instagramField) instagramField.value = org.social.instagram;
            if (twitterField) twitterField.value = org.social.twitter;
        }

        // Show admin controls for Barkhaus admin
        function showAdminControls() {
            // Add organization switcher to header
            const headerControls = document.querySelector('header .flex.items-center.space-x-4');
            if (headerControls && !document.getElementById('orgSwitcher')) {
                const orgSwitcher = document.createElement('div');
                orgSwitcher.id = 'orgSwitcher';
                orgSwitcher.className = 'flex items-center space-x-2';
                orgSwitcher.innerHTML = `
                    <label class="text-sm text-gray-600">Switch Org:</label>
                    <select id="orgSelect" class="text-sm border rounded px-2 py-1">
                        <option value="8">Barkhaus Admin</option>
                        <option value="3">Happy Paws Dog Rescue</option>
                        <option value="4">Furry Friends Sanctuary</option>
                        <option value="5">Paws & Hearts Rescue</option>
                        <option value="6">Second Chance Animal Rescue</option>
                        <option value="7">Loving Tails Foundation</option>
                        <option value="9">Rescue Rangers Network</option>
                    </select>
                `;
                headerControls.insertBefore(orgSwitcher, headerControls.firstChild);

                // Add event listener for organization switching
                document.getElementById('orgSelect').addEventListener('change', function() {
                    const newOrgId = this.value;
                    switchOrganization(newOrgId);
                });
            }
        }

        // Switch organization (admin only)
        function switchOrganization(orgId) {
            const org = organizations[orgId];
            if (!org) return;

            currentOrg = org;
            currentOrgId = orgId;

            // Apply new branding
            applyOrganizationBranding(orgId);

            // Update displays
            currentOrgIdSpan.textContent = orgId;

            // Reload data for new organization
            loadAnimalsPreview();

            // Show success message
            showSuccessMessage(`Switched to ${org.name}`);
        }

        function showLoginError(message) {
            loginError.textContent = message;
            loginError.classList.remove('hidden');
        }

        // Show success message
        function showSuccessMessage(message) {
            // Create or update success message element
            let successMsg = document.getElementById('successMessage');
            if (!successMsg) {
                successMsg = document.createElement('div');
                successMsg.id = 'successMessage';
                successMsg.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded shadow-lg z-50';
                document.body.appendChild(successMsg);
            }

            successMsg.textContent = message;
            successMsg.style.display = 'block';

            // Auto-hide after 3 seconds
            setTimeout(() => {
                successMsg.style.display = 'none';
            }, 3000);
        }

        // Visit Website Function
        function visitWebsite() {
            // Get the current production URL
            const productionUrl = 'https://happy-paws-site-c2kpitgw4-rigby35xs-projects.vercel.app';
            window.open(productionUrl, '_blank');
        }

        // Color picker synchronization functions
        function updateColorText(pickerId, textId) {
            const picker = document.getElementById(pickerId);
            const text = document.getElementById(textId);
            text.value = picker.value;
        }

        function updateColorPicker(textId, pickerId) {
            const text = document.getElementById(textId);
            const picker = document.getElementById(pickerId);
            if (text.value.match(/^#[0-9A-F]{6}$/i)) {
                picker.value = text.value;
            }
        }

        function handleLogout() {
            currentOrgId = null;
            animals = [];
            editingAnimalId = null;

            loginScreen.classList.remove('hidden');
            dashboard.classList.add('hidden');
            loginError.classList.add('hidden');

            // Reset form
            document.getElementById('orgId').value = '3';
            document.getElementById('accessCode').value = 'demo123';
        }

        // Load animals from API
        async function loadAnimals() {
            try {
                showLoading();

                const response = await fetch(`/api/admin/animals?orgId=${currentOrgId}`);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                animals = await response.json();
                updateStats();
                displayAnimals();

            } catch (error) {
                console.error('Error loading animals:', error);
                showError('Failed to load animals. Please try again.');
            }
        }

        function showLoading() {
            loadingMessage.classList.remove('hidden');
            errorMessage.classList.add('hidden');
            animalsList.classList.add('hidden');
            noAnimalsMessage.classList.add('hidden');
        }

        function showError(message) {
            loadingMessage.classList.add('hidden');
            errorMessage.textContent = message;
            errorMessage.classList.remove('hidden');
            animalsList.classList.add('hidden');
            noAnimalsMessage.classList.add('hidden');
        }

        function updateStats() {
            const total = animals.length;
            const available = animals.filter(a => a.status === 'Available').length;
            const pending = animals.filter(a => a.status === 'Pending').length;
            const adopted = animals.filter(a => a.status === 'Adopted').length;

            totalAnimalsEl.textContent = total;
            availableAnimalsEl.textContent = available;
            pendingAnimalsEl.textContent = pending;
            adoptedAnimalsEl.textContent = adopted;
        }

        function displayAnimals() {
            loadingMessage.classList.add('hidden');
            errorMessage.classList.add('hidden');

            if (animals.length === 0) {
                animalsList.classList.add('hidden');
                noAnimalsMessage.classList.remove('hidden');
                return;
            }

            noAnimalsMessage.classList.add('hidden');
            animalsList.classList.remove('hidden');

            animalsList.innerHTML = animals.map(animal => `
                <div class="animal-card">
                    <div class="flex items-center space-x-4">
                        <img src="${animal.image_url || 'https://via.placeholder.com/80x80?text=No+Image'}"
                             alt="${animal.name}" class="animal-image">
                        <div class="flex-1">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-semibold text-gray-900">${animal.name}</h3>
                                <span class="status-badge status-${animal.status.toLowerCase()}">${animal.status}</span>
                            </div>
                            <p class="text-gray-600">${animal.species} • ${animal.breed || 'Mixed'} • ${animal.age || 'Unknown'} years old</p>
                            <p class="text-gray-500 text-sm mt-1">${animal.description ? animal.description.substring(0, 100) + '...' : 'No description'}</p>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="editAnimal(${animal.id})" class="btn-secondary">Edit</button>
                            <button onclick="deleteAnimal(${animal.id})" class="btn-danger">Delete</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function filterAnimals() {
            const statusValue = statusFilter.value;
            const speciesValue = speciesFilter.value;
            const searchValue = searchInput.value.toLowerCase();

            const filteredAnimals = animals.filter(animal => {
                const matchesStatus = !statusValue || animal.status === statusValue;
                const matchesSpecies = !speciesValue || animal.species === speciesValue;
                const matchesSearch = !searchValue || animal.name.toLowerCase().includes(searchValue);

                return matchesStatus && matchesSpecies && matchesSearch;
            });

            // Temporarily store original animals array
            const originalAnimals = animals;
            animals = filteredAnimals;
            displayAnimals();
            updateStats();
            animals = originalAnimals; // Restore original array
        }

        // Filter function for full animals tab
        function filterAnimalsInTab() {
            const statusFilterFull = document.getElementById('statusFilterFull');
            const speciesFilterFull = document.getElementById('speciesFilterFull');
            const searchInputFull = document.getElementById('searchInputFull');

            const statusValue = statusFilterFull ? statusFilterFull.value : '';
            const speciesValue = speciesFilterFull ? speciesFilterFull.value : '';
            const searchValue = searchInputFull ? searchInputFull.value.toLowerCase() : '';

            const filteredAnimals = animals.filter(animal => {
                const matchesStatus = !statusValue || animal.status === statusValue;
                const matchesSpecies = !speciesValue || animal.species === speciesValue;
                const matchesSearch = !searchValue || animal.name.toLowerCase().includes(searchValue);

                return matchesStatus && matchesSpecies && matchesSearch;
            });

            displayAnimalsInTab(filteredAnimals);
        }

        // Modal functions
        function openModal(animalId = null) {
            console.log('Opening modal for animal:', animalId);
            editingAnimalId = animalId;

            if (animalId) {
                modalTitle.textContent = 'Edit Animal';
                const animal = animals.find(a => a.id === animalId);
                if (animal) {
                    console.log('Found animal for editing:', animal);
                    populateForm(animal);
                } else {
                    console.error('Animal not found with ID:', animalId);
                    alert('Animal not found. Please refresh and try again.');
                    return;
                }
            } else {
                modalTitle.textContent = 'Add New Animal';
                animalForm.reset();
                clearImages(); // Clear uploaded images for new animal
            }

            formError.classList.add('hidden');
            formSuccess.classList.add('hidden');
            animalModal.classList.add('show');
        }

        function closeModal() {
            animalModal.classList.remove('show');
            editingAnimalId = null;
            animalForm.reset();
        }

        function populateForm(animal) {
            console.log('Populating form with animal data:', animal);

            document.getElementById('animalName').value = animal.name || '';
            document.getElementById('animalSpecies').value = animal.species || '';
            document.getElementById('animalBreed').value = animal.breed || '';
            document.getElementById('animalAge').value = animal.age || '';
            document.getElementById('animalGender').value = animal.gender || '';
            document.getElementById('animalSize').value = animal.size || '';
            document.getElementById('animalWeight').value = animal.weight || '';
            document.getElementById('animalStatus').value = animal.status || '';
            document.getElementById('animalIntakeDate').value = animal.intake_date || '';
            document.getElementById('animalAdoptionFee').value = animal.adoption_fee || '';
            document.getElementById('animalImageUrl').value = animal.image_url || '';
            document.getElementById('animalDescription').value = animal.description || '';

            document.getElementById('animalSpecialNeeds').checked = animal.special_needs || false;
            document.getElementById('animalGoodWithKids').checked = animal.good_with_kids || false;
            document.getElementById('animalGoodWithCats').checked = animal.good_with_cats || false;
            document.getElementById('animalGoodWithDogs').checked = animal.good_with_dogs || false;
            document.getElementById('animalSpayedNeutered').checked = animal.spayed_neutered || false;
            document.getElementById('animalVaccinated').checked = animal.vaccinated || false;
            document.getElementById('animalMicrochip').checked = animal.microchip || false;

            // Handle existing images
            uploadedImages = [];
            if (animal.image_url) {
                uploadedImages.push(animal.image_url);
            }
            // Handle additional images if they exist
            if (animal.images && Array.isArray(animal.images)) {
                animal.images.forEach(img => {
                    if (img && !uploadedImages.includes(img)) {
                        uploadedImages.push(img);
                    }
                });
            }
            updateImagePreview();
        }

        async function handleSaveAnimal(e) {
            e.preventDefault();
            console.log('Saving animal, editingAnimalId:', editingAnimalId);
            console.log('Uploaded images:', uploadedImages);

            // For now, use URL field instead of large base64 data to avoid API issues
            const imageUrl = document.getElementById('animalImageUrl').value ||
                           (uploadedImages.length > 0 ? 'https://via.placeholder.com/400x300?text=Uploaded+Image' : '');

            console.log('Image URL being saved:', imageUrl);
            console.log('Uploaded images count:', uploadedImages.length);

            const formData = {
                name: document.getElementById('animalName').value,
                species: document.getElementById('animalSpecies').value,
                breed: document.getElementById('animalBreed').value,
                age: parseInt(document.getElementById('animalAge').value) || null,
                gender: document.getElementById('animalGender').value,
                size: document.getElementById('animalSize').value,
                weight: document.getElementById('animalWeight').value,
                status: document.getElementById('animalStatus').value,
                intake_date: document.getElementById('animalIntakeDate').value,
                adoption_fee: parseFloat(document.getElementById('animalAdoptionFee').value) || null,
                image_url: imageUrl,
                description: document.getElementById('animalDescription').value,
                special_needs: document.getElementById('animalSpecialNeeds').checked,
                good_with_kids: document.getElementById('animalGoodWithKids').checked,
                good_with_cats: document.getElementById('animalGoodWithCats').checked,
                good_with_dogs: document.getElementById('animalGoodWithDogs').checked,
                spayed_neutered: document.getElementById('animalSpayedNeutered').checked,
                vaccinated: document.getElementById('animalVaccinated').checked,
                microchip: document.getElementById('animalMicrochip').checked,
                orgId: currentOrgId
            };

            // For editing, add the ID to the data
            if (editingAnimalId) {
                formData.id = editingAnimalId;
            }

            try {
                saveBtn.classList.add('loading');
                formError.classList.add('hidden');
                formSuccess.classList.add('hidden');

                const url = editingAnimalId
                    ? `/api/admin/animals`
                    : '/api/admin/animals';
                const method = editingAnimalId ? 'PUT' : 'POST';

                console.log('Sending request to:', url);
                console.log('Method:', method);
                console.log('Form data:', formData);

                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                console.log('Response status:', response.status);
                console.log('Response ok:', response.ok);

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('Response error:', errorText);
                    throw new Error(`HTTP error! status: ${response.status}, message: ${errorText}`);
                }

                const result = await response.json();

                formSuccess.textContent = editingAnimalId ? 'Animal updated successfully!' : 'Animal added successfully!';
                formSuccess.classList.remove('hidden');

                // Reload animals list/preview
                const currentTab = document.querySelector('.sidebar-tab.active').id.replace('tab-', '');
                if (currentTab === 'animals') {
                    await loadAnimalsForTab();
                } else {
                    await loadAnimalsPreview();
                }

                // Close modal after a short delay
                setTimeout(() => {
                    closeModal();
                }, 1500);

            } catch (error) {
                console.error('Error saving animal:', error);
                formError.textContent = `Failed to save animal: ${error.message}`;
                formError.classList.remove('hidden');
            } finally {
                saveBtn.classList.remove('loading');
            }
        }

        // Image Upload Functionality
        let uploadedImages = [];

        function initializeImageUpload() {
            const uploadArea = document.getElementById('imageUploadArea');
            const fileInput = document.getElementById('imageFileInput');
            const previewGrid = document.getElementById('imagePreviewGrid');
            const previewContainer = document.getElementById('imagePreviewContainer');
            const imageCount = document.getElementById('imageCount');

            // Click to upload
            uploadArea.addEventListener('click', () => {
                if (uploadedImages.length < 5) {
                    fileInput.click();
                }
            });

            // File input change
            fileInput.addEventListener('change', (e) => {
                handleFiles(e.target.files);
            });

            // Drag and drop
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('border-blue-400', 'bg-blue-50');
            });

            uploadArea.addEventListener('dragleave', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('border-blue-400', 'bg-blue-50');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('border-blue-400', 'bg-blue-50');
                handleFiles(e.dataTransfer.files);
            });
        }

        function handleFiles(files) {
            const fileArray = Array.from(files);

            // Check limit
            if (uploadedImages.length + fileArray.length > 5) {
                alert(`You can only upload up to 5 images. You currently have ${uploadedImages.length} images.`);
                return;
            }

            fileArray.forEach(file => {
                if (!file.type.startsWith('image/')) {
                    alert(`${file.name} is not a valid image file.`);
                    return;
                }

                if (file.size > 5 * 1024 * 1024) {
                    alert(`${file.name} is too large. Please choose an image under 5MB.`);
                    return;
                }

                // Show loading indicator
                const uploadArea = document.getElementById('imageUploadArea');
                const originalText = uploadArea.innerHTML;
                uploadArea.innerHTML = `<div class="text-center"><div class="text-blue-600">Processing ${file.name}...</div></div>`;

                // Convert image to base64 data URL for storage
                const reader = new FileReader();
                reader.onload = function(e) {
                    const dataUrl = e.target.result;
                    uploadedImages.push(dataUrl);
                    updateImagePreview();

                    // Also set the main image URL field if it's the first image
                    if (uploadedImages.length === 1) {
                        document.getElementById('animalImageUrl').value = dataUrl;
                    }

                    // Restore upload area
                    uploadArea.innerHTML = originalText;
                    console.log('Image uploaded successfully:', file.name);
                };
                reader.onerror = function() {
                    uploadArea.innerHTML = originalText;
                    alert(`Failed to read ${file.name}. Please try again.`);
                };
                reader.readAsDataURL(file);
            });
        }

        function updateImagePreview() {
            const previewGrid = document.getElementById('imagePreviewGrid');
            const previewContainer = document.getElementById('imagePreviewContainer');
            const imageCount = document.getElementById('imageCount');
            const uploadArea = document.getElementById('imageUploadArea');

            imageCount.textContent = uploadedImages.length;

            if (uploadedImages.length > 0) {
                previewGrid.classList.remove('hidden');
                uploadArea.style.opacity = uploadedImages.length >= 5 ? '0.5' : '1';
                uploadArea.style.pointerEvents = uploadedImages.length >= 5 ? 'none' : 'auto';

                previewContainer.innerHTML = uploadedImages.map((image, index) => `
                    <div class="relative group">
                        <img src="${image}" alt="Preview ${index + 1}"
                             class="w-full h-20 object-cover rounded border-2 border-transparent hover:border-blue-300 transition-colors">
                        ${index === 0 ? '<div class="absolute top-1 left-1 bg-green-500 text-white text-xs px-1 rounded">Main</div>' : ''}
                        <button onclick="removeImage(${index})"
                                class="absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 opacity-0 group-hover:opacity-100 transition-opacity">
                            <svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                        </button>
                    </div>
                `).join('');
            } else {
                previewGrid.classList.add('hidden');
                uploadArea.style.opacity = '1';
                uploadArea.style.pointerEvents = 'auto';
            }
        }

        function removeImage(index) {
            uploadedImages.splice(index, 1);
            updateImagePreview();
        }

        function clearImages() {
            uploadedImages = [];
            updateImagePreview();
        }

        // Test function to verify JavaScript is working
        window.testFunction = function() {
            alert('JavaScript is working! Functions are accessible.');
            console.log('Test function called successfully');
            console.log('Current uploaded images:', uploadedImages);
        };

        // Global functions for inline event handlers
        window.editAnimal = function(animalId) {
            console.log('Edit animal clicked:', animalId);
            openModal(animalId);
        };

        window.deleteAnimal = async function(animalId) {
            console.log('Delete animal clicked:', animalId);
            if (!confirm('Are you sure you want to delete this animal? This action cannot be undone.')) {
                return;
            }

            try {
                const response = await fetch(`/api/admin/animals?id=${animalId}&orgId=${currentOrgId}`, {
                    method: 'DELETE'
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                // Reload animals list/preview
                const currentTab = document.querySelector('.sidebar-tab.active').id.replace('tab-', '');
                if (currentTab === 'animals') {
                    await loadAnimalsForTab();
                } else {
                    await loadAnimalsPreview();
                }

            } catch (error) {
                console.error('Error deleting animal:', error);
                alert('Failed to delete animal. Please try again.');
            }
        };

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Load organizations from Xano
            loadOrganizationsFromXano();

            // Check if already logged in (for demo purposes)
            // In a real app, you'd check for a valid session/token

            // Initialize image upload functionality
            initializeImageUpload();

            // Set up all event listeners
            loginForm.addEventListener('submit', handleLogin);
            logoutBtn.addEventListener('click', handleLogout);
            addAnimalBtn.addEventListener('click', () => openModal());

            // Check if full animals tab button exists before adding listener
            const addAnimalBtnFull = document.getElementById('addAnimalBtnFull');
            if (addAnimalBtnFull) {
                addAnimalBtnFull.addEventListener('click', () => openModal());
            }

            closeModalBtn.addEventListener('click', closeModal);
            cancelBtn.addEventListener('click', closeModal);
            animalForm.addEventListener('submit', handleSaveAnimal);
            refreshBtn.addEventListener('click', loadAnimals);

            // Check if full refresh button exists before adding listener
            const refreshBtnFull = document.getElementById('refreshBtnFull');
            if (refreshBtnFull) {
                refreshBtnFull.addEventListener('click', loadAnimalsForTab);
            }

            // Filter event listeners
            statusFilter.addEventListener('change', filterAnimals);
            speciesFilter.addEventListener('change', filterAnimals);
            searchInput.addEventListener('input', filterAnimals);

            // Full animals tab filter event listeners
            const statusFilterFull = document.getElementById('statusFilterFull');
            const speciesFilterFull = document.getElementById('speciesFilterFull');
            const searchInputFull = document.getElementById('searchInputFull');

            if (statusFilterFull) {
                statusFilterFull.addEventListener('change', filterAnimalsInTab);
            }
            if (speciesFilterFull) {
                speciesFilterFull.addEventListener('change', filterAnimalsInTab);
            }
            if (searchInputFull) {
                searchInputFull.addEventListener('input', filterAnimalsInTab);
            }

            // Close modal when clicking outside
            animalModal.addEventListener('click', (e) => {
                if (e.target === animalModal) {
                    closeModal();
                }
            });
        });

        // Tab Management Functions
        function showDashboardTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => {
                content.classList.add('hidden');
            });

            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.sidebar-tab');
            tabs.forEach(tab => {
                tab.classList.remove('active', 'bg-blue-100', 'text-blue-700');
                tab.classList.add('text-gray-600');
            });

            // Show selected tab content
            const selectedContent = document.getElementById(`tab-content-${tabName}`);
            if (selectedContent) {
                selectedContent.classList.remove('hidden');
            }

            // Add active class to selected tab
            const selectedTab = document.getElementById(`tab-${tabName}`);
            if (selectedTab) {
                selectedTab.classList.add('active', 'bg-blue-100', 'text-blue-700');
                selectedTab.classList.remove('text-gray-600');
            }

            // Update page title and subtitle
            updatePageTitle(tabName);

            // Load appropriate content
            if (tabName === 'animals') {
                loadAnimalsForTab();
            } else if (tabName === 'overview') {
                loadAnimalsPreview();
            } else if (tabName === 'settings') {
                loadOrganizationSettings();
            } else if (tabName === 'social-media') {
                loadSocialMediaData();
            }
        }

        function updatePageTitle(tabName) {
            const pageTitle = document.getElementById('pageTitle');
            const pageSubtitle = document.getElementById('pageSubtitle');

            const titles = {
                'overview': {
                    title: 'Dashboard',
                    subtitle: 'Welcome back! Here\'s what\'s happening at your rescue.'
                },
                'animals': {
                    title: 'Animals Management',
                    subtitle: 'Manage all animals in your rescue system.'
                },
                'applications': {
                    title: 'Adoption Applications',
                    subtitle: 'Review and manage adoption applications.'
                },
                'events': {
                    title: 'Events Management',
                    subtitle: 'Plan and manage adoption events and activities.'
                },
                'donations': {
                    title: 'Donations Tracking',
                    subtitle: 'Monitor donations and manage donor relationships.'
                },
                'communications': {
                    title: 'Communications',
                    subtitle: 'Send emails and messages to your community.'
                },
                'social-media': {
                    title: 'Social Media',
                    subtitle: 'Create and schedule social media posts.'
                },
                'settings': {
                    title: 'Settings',
                    subtitle: 'Configure your organization and website settings.'
                }
            };

            if (titles[tabName]) {
                pageTitle.textContent = titles[tabName].title;
                pageSubtitle.textContent = titles[tabName].subtitle;
            }
        }

        // Organization-specific animal data
        const organizationAnimals = {
            3: [ // Happy Paws Dog Rescue
                {
                    id: 1,
                    name: "Buddy",
                    breed: "Golden Retriever",
                    age: "3 years",
                    species: "Dog",
                    status: "Available",
                    image_url: "https://images.unsplash.com/photo-1552053831-71594a27632d?w=400",
                    description: "Friendly and energetic dog looking for an active family."
                },
                {
                    id: 2,
                    name: "Luna",
                    breed: "Border Collie",
                    age: "2 years",
                    species: "Dog",
                    status: "Pending",
                    image_url: "https://images.unsplash.com/photo-1551717743-49959800b1f6?w=400",
                    description: "Smart and loyal companion, great with kids."
                }
            ],
            4: [ // Furry Friends Sanctuary
                {
                    id: 3,
                    name: "Max",
                    breed: "German Shepherd",
                    age: "4 years",
                    species: "Dog",
                    status: "Available",
                    image_url: "https://images.unsplash.com/photo-1589941013453-ec89f33b5e95?w=400",
                    description: "Protective and loving, needs experienced owner."
                },
                {
                    id: 4,
                    name: "Bella",
                    breed: "Labrador Mix",
                    age: "1 year",
                    species: "Dog",
                    status: "Available",
                    image_url: "https://images.unsplash.com/photo-1518717758536-85ae29035b6d?w=400",
                    description: "Playful puppy ready for training and love."
                }
            ],
            5: [ // Paws & Hearts Rescue
                {
                    id: 5,
                    name: "Charlie",
                    breed: "Beagle",
                    age: "5 years",
                    species: "Dog",
                    status: "Available",
                    image_url: "https://images.unsplash.com/photo-1544717297-fa95b6ee9643?w=400",
                    description: "Gentle senior dog looking for a quiet home."
                },
                {
                    id: 6,
                    name: "Daisy",
                    breed: "Poodle Mix",
                    age: "2 years",
                    species: "Dog",
                    status: "Adopted",
                    image_url: "https://images.unsplash.com/photo-1616190264687-b7ebf7aa2eb4?w=400",
                    description: "Recently adopted! Living happily with new family."
                }
            ],
            6: [ // Second Chance Animal Rescue
                {
                    id: 7,
                    name: "Rocky",
                    breed: "Pit Bull Mix",
                    age: "3 years",
                    species: "Dog",
                    status: "Available",
                    image_url: "https://images.unsplash.com/photo-1583337130417-3346a1be7dee?w=400",
                    description: "Sweet and gentle giant, great with other dogs."
                },
                {
                    id: 8,
                    name: "Molly",
                    breed: "Husky",
                    age: "4 years",
                    species: "Dog",
                    status: "Pending",
                    image_url: "https://images.unsplash.com/photo-1605568427561-40dd23c2acea?w=400",
                    description: "High-energy dog perfect for active families."
                }
            ],
            7: [ // Loving Tails Foundation
                {
                    id: 9,
                    name: "Cooper",
                    breed: "Australian Shepherd",
                    age: "2 years",
                    species: "Dog",
                    status: "Available",
                    image_url: "https://images.unsplash.com/photo-1551717743-49959800b1f6?w=400",
                    description: "Intelligent herding dog, needs mental stimulation."
                },
                {
                    id: 10,
                    name: "Sadie",
                    breed: "Boxer",
                    age: "6 years",
                    species: "Dog",
                    status: "Available",
                    image_url: "https://images.unsplash.com/photo-1587300003388-59208cc962cb?w=400",
                    description: "Loving senior looking for a comfortable retirement home."
                }
            ],
            8: [ // Barkhaus Admin (can see all)
                {
                    id: 11,
                    name: "Admin Test Dog",
                    breed: "Mixed Breed",
                    age: "1 year",
                    species: "Dog",
                    status: "Available",
                    image_url: "https://images.unsplash.com/photo-1552053831-71594a27632d?w=400",
                    description: "Test animal for admin purposes."
                }
            ],
            9: [ // Rescue Rangers Network
                {
                    id: 12,
                    name: "Ranger",
                    breed: "German Shepherd",
                    age: "5 years",
                    species: "Dog",
                    status: "Available",
                    image_url: "https://images.unsplash.com/photo-1589941013453-ec89f33b5e95?w=400",
                    description: "Trained rescue dog, excellent for search and rescue work."
                },
                {
                    id: 13,
                    name: "Scout",
                    breed: "Border Collie",
                    age: "3 years",
                    species: "Dog",
                    status: "Available",
                    image_url: "https://images.unsplash.com/photo-1551717743-49959800b1f6?w=400",
                    description: "Agile and smart, perfect for outdoor adventures."
                }
            ]
        };

        // Load animals preview for dashboard
        async function loadAnimalsPreview() {
            try {
                // Load from Xano API
                const response = await fetch(`/api/admin/animals?orgId=${currentOrgId}`);
                if (response.ok) {
                    animals = await response.json();
                } else {
                    // Fallback to organization-specific data
                    animals = organizationAnimals[currentOrgId] || [];
                }

                // If Barkhaus admin, can see all animals when in admin mode
                if (currentOrg && currentOrg.isAdmin && currentOrgId === '8') {
                    try {
                        // Try to load all animals from all orgs
                        const allAnimalsPromises = [3, 4, 5, 6, 7, 9].map(async (orgId) => {
                            try {
                                const response = await fetch(`/api/admin/animals?orgId=${orgId}`);
                                if (response.ok) {
                                    return await response.json();
                                }
                                return [];
                            } catch (error) {
                                return [];
                            }
                        });

                        const allAnimalsArrays = await Promise.all(allAnimalsPromises);
                        animals = allAnimalsArrays.flat();
                    } catch (error) {
                        console.warn('Failed to load all animals for admin, using fallback');
                        animals = Object.values(organizationAnimals).flat();
                    }
                }

                const recentAnimals = animals.slice(0, 5); // Show only 5 most recent

                const previewContainer = document.getElementById('recentAnimalsPreview');
                if (recentAnimals.length === 0) {
                    previewContainer.innerHTML = '<div class="text-center py-8 text-gray-500">No animals found.</div>';
                    return;
                }

                previewContainer.innerHTML = recentAnimals.map(animal => `
                    <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50">
                        <div class="flex items-center space-x-4">
                            <img src="${animal.image_url || '/assets/images/placeholder-animal.jpg'}"
                                 alt="${animal.name}" class="w-12 h-12 rounded-full object-cover">
                            <div>
                                <h4 class="font-medium text-gray-900">${animal.name}</h4>
                                <p class="text-sm text-gray-600">${animal.species} • ${animal.breed || 'Mixed'}</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="status-badge status-${animal.status.toLowerCase()}">${animal.status}</span>
                            <button onclick="editAnimal(${animal.id})" class="text-blue-600 hover:text-blue-800 text-sm">Edit</button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading animals preview:', error);
                document.getElementById('recentAnimalsPreview').innerHTML =
                    '<div class="text-center py-8 text-red-500">Error loading animals</div>';
            }
        }

        // Load animals for full animals tab
        async function loadAnimalsForTab() {
            try {
                const response = await fetch(`/api/admin/animals?orgId=${currentOrgId}`);
                if (!response.ok) throw new Error('Failed to fetch animals');

                animals = await response.json(); // Update global animals array
                displayAnimalsInTab(animals);
            } catch (error) {
                console.error('Error loading animals:', error);
                document.getElementById('errorMessageFull').textContent = 'Error loading animals: ' + error.message;
                document.getElementById('errorMessageFull').classList.remove('hidden');
            }
        }

        function displayAnimalsInTab(animals) {
            const loadingMsg = document.getElementById('loadingMessageFull');
            const errorMsg = document.getElementById('errorMessageFull');
            const animalsList = document.getElementById('animalsListFull');
            const noAnimalsMsg = document.getElementById('noAnimalsMessageFull');

            loadingMsg.classList.add('hidden');
            errorMsg.classList.add('hidden');

            if (animals.length === 0) {
                animalsList.classList.add('hidden');
                noAnimalsMsg.classList.remove('hidden');
                return;
            }

            noAnimalsMsg.classList.add('hidden');
            animalsList.classList.remove('hidden');

            animalsList.innerHTML = animals.map(animal => `
                <div class="animal-card border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                    <div class="flex items-start space-x-4">
                        <img src="${animal.image_url || '/assets/images/placeholder-animal.jpg'}"
                             alt="${animal.name}" class="w-20 h-20 rounded-lg object-cover">
                        <div class="flex-1">
                            <div class="flex justify-between items-start">
                                <div>
                                    <h3 class="text-lg font-medium text-gray-900">${animal.name}</h3>
                                    <p class="text-gray-600">${animal.species} • ${animal.breed || 'Mixed'} • ${animal.age || 'Unknown'} years</p>
                                    <p class="text-sm text-gray-500 mt-1">${animal.description || 'No description available'}</p>
                                </div>
                                <span class="status-badge status-${animal.status.toLowerCase()}">${animal.status}</span>
                            </div>
                            <div class="flex justify-between items-center mt-4">
                                <div class="text-sm text-gray-500">
                                    Added: ${new Date(animal.created_at).toLocaleDateString()}
                                </div>
                                <div class="flex space-x-2">
                                    <button onclick="editAnimal(${animal.id})" class="btn-secondary text-sm">Edit</button>
                                    <button onclick="deleteAnimal(${animal.id})" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm">Delete</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Settings section management
        function showSettingsSection(sectionName) {
            // Hide all settings sections
            const sections = document.querySelectorAll('.settings-section');
            sections.forEach(section => {
                section.classList.add('hidden');
            });

            // Remove active class from all settings tabs
            const tabs = document.querySelectorAll('.settings-tab');
            tabs.forEach(tab => {
                tab.classList.remove('active', 'bg-blue-100', 'text-blue-700');
                tab.classList.add('bg-gray-100', 'text-gray-700');
            });

            // Show selected section
            const selectedSection = document.getElementById(`settings-${sectionName}`);
            if (selectedSection) {
                selectedSection.classList.remove('hidden');
            }

            // Add active class to selected tab
            const selectedTab = document.getElementById(`settings-tab-${sectionName}`);
            if (selectedTab) {
                selectedTab.classList.add('active', 'bg-blue-100', 'text-blue-700');
                selectedTab.classList.remove('bg-gray-100', 'text-gray-700');
            }

            // Load data for specific sections
            if (sectionName === 'organization') {
                loadOrganizationSettings();
            }
        }

        // CSV Upload Functions
        let csvData = [];

        function handleCSVUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            if (file.size > 5 * 1024 * 1024) { // 5MB limit
                alert('File size must be less than 5MB');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const csv = e.target.result;
                parseCSV(csv);
            };
            reader.readAsText(file);
        }

        function parseCSV(csv) {
            const lines = csv.split('\n').filter(line => line.trim());
            if (lines.length < 2) {
                alert('CSV file must have at least a header row and one data row');
                return;
            }

            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
            csvData = lines.slice(1).map(line => {
                const values = line.split(',').map(v => v.trim().replace(/"/g, ''));
                const row = {};
                headers.forEach((header, index) => {
                    row[header] = values[index] || '';
                });
                return row;
            });

            displayCSVPreview(headers, csvData.slice(0, 5));
            document.getElementById('processCSVBtn').disabled = false;
        }

        function displayCSVPreview(headers, data) {
            const preview = document.getElementById('csvPreview');
            const headersEl = document.getElementById('csvHeaders');
            const dataEl = document.getElementById('csvData');

            // Create headers
            headersEl.innerHTML = '<tr>' + headers.map(h => `<th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">${h}</th>`).join('') + '</tr>';

            // Create data rows
            dataEl.innerHTML = data.map(row =>
                '<tr class="border-t">' +
                headers.map(h => `<td class="px-4 py-2 text-sm text-gray-900">${row[h] || ''}</td>`).join('') +
                '</tr>'
            ).join('');

            preview.classList.remove('hidden');
        }

        function downloadCSVTemplate() {
            const headers = ['name', 'species', 'breed', 'age', 'gender', 'size', 'status', 'description', 'special_needs', 'good_with_kids', 'good_with_cats', 'good_with_dogs', 'spayed_neutered', 'vaccinated', 'microchip', 'image_url'];
            const sampleData = ['Buddy', 'dog', 'Golden Retriever', '3', 'Male', 'Large', 'Available', 'Friendly and energetic dog', 'false', 'true', 'true', 'true', 'true', 'true', 'true', 'https://example.com/buddy.jpg'];

            const csvContent = headers.join(',') + '\n' + sampleData.join(',');
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'animal_import_template.csv';
            a.click();
            window.URL.revokeObjectURL(url);
        }

        async function processCSVUpload() {
            if (csvData.length === 0) {
                alert('No data to process');
                return;
            }

            try {
                const response = await fetch('/api/admin/animals/bulk-import', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        orgId: currentOrgId,
                        animals: csvData
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    alert(`Successfully imported ${result.imported} animals. ${result.errors || 0} errors.`);

                    // Reset form
                    document.getElementById('csvUpload').value = '';
                    document.getElementById('csvPreview').classList.add('hidden');
                    document.getElementById('processCSVBtn').disabled = true;
                    csvData = [];

                    // Refresh animals list if on animals tab
                    const currentTab = document.querySelector('.sidebar-tab.active').id.replace('tab-', '');
                    if (currentTab === 'animals') {
                        await loadAnimalsForTab();
                    } else {
                        await loadAnimalsPreview();
                    }
                } else {
                    throw new Error('Failed to import animals');
                }
            } catch (error) {
                console.error('Error importing animals:', error);
                alert('Failed to import animals. Please check your data and try again.');
            }
        }

        // FAQ Management Functions
        let faqCounter = 3; // Start from 4 since we have 3 existing FAQs

        function addNewFAQ() {
            faqCounter++;
            const faqContainer = document.querySelector('.space-y-4');
            const addButton = faqContainer.querySelector('button');

            const newFAQ = document.createElement('div');
            newFAQ.className = 'border border-gray-200 rounded-lg p-4 bg-white';
            newFAQ.innerHTML = `
                <div class="flex justify-between items-start mb-3">
                    <h5 class="font-medium text-gray-900">FAQ ${faqCounter}</h5>
                    <button onclick="removeFAQ(this)" class="text-red-600 hover:text-red-800 text-sm">Remove</button>
                </div>
                <div class="form-group">
                    <label class="form-label">FAQ ${faqCounter} - Question</label>
                    <input type="text" class="form-input" placeholder="Enter your question..." value="">
                </div>
                <div class="form-group">
                    <label class="form-label">FAQ ${faqCounter} - Answer</label>
                    <textarea class="form-input" rows="3" placeholder="Enter your answer..."></textarea>
                </div>
            `;

            // Insert before the "Add Another FAQ" button
            faqContainer.insertBefore(newFAQ, addButton);

            showSuccessMessage(`FAQ ${faqCounter} added successfully!`);
        }

        function removeFAQ(button) {
            const faqDiv = button.closest('.border');
            faqDiv.remove();
            showSuccessMessage('FAQ removed successfully!');
        }

        // Website Content Save Function
        async function saveWebsiteContent() {
            try {
                // Collect FAQ data
                const faqs = [];
                const faqElements = document.querySelectorAll('.space-y-4 .border.border-gray-200');

                faqElements.forEach((faqEl, index) => {
                    const question = faqEl.querySelector('input[type="text"]')?.value || '';
                    const answer = faqEl.querySelector('textarea')?.value || '';

                    if (question.trim() && answer.trim()) {
                        faqs.push({
                            id: index + 1,
                            question: question.trim(),
                            answer: answer.trim()
                        });
                    }
                });

                // Collect social media data
                const socialMedia = {
                    instagram: document.getElementById('instagramUrl')?.value || '',
                    facebook: document.getElementById('facebookUrl')?.value || '',
                    twitter: document.getElementById('twitterUrl')?.value || ''
                };

                // Collect other website content
                const websiteContent = {
                    faqs: faqs,
                    socialMedia: socialMedia,
                    orgId: currentOrgId,
                    lastUpdated: new Date().toISOString()
                };

                console.log('Saving website content:', websiteContent);

                // Save to API (you can implement this endpoint)
                const response = await fetch('/api/admin/website-content', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(websiteContent)
                });

                if (response.ok) {
                    showSuccessMessage('Website content saved successfully! Changes will appear on the front-end site.');

                    // Update footer social media icons on front-end
                    updateFrontendSocialMedia(socialMedia);
                } else {
                    throw new Error('Failed to save website content');
                }

            } catch (error) {
                console.error('Error saving website content:', error);
                showSuccessMessage('Website content saved locally! (API endpoint not yet implemented)');

                // For now, just update the frontend directly
                const socialMedia = {
                    instagram: document.getElementById('instagramUrl')?.value || '',
                    facebook: document.getElementById('facebookUrl')?.value || '',
                    twitter: document.getElementById('twitterUrl')?.value || ''
                };
                updateFrontendSocialMedia(socialMedia);
            }
        }

        // Update frontend social media icons
        function updateFrontendSocialMedia(socialMedia) {
            // Store in localStorage for now (in production, this would be saved to database)
            localStorage.setItem(`socialMedia_${currentOrgId}`, JSON.stringify(socialMedia));

            console.log('Social media links updated for organization', currentOrgId, socialMedia);

            // In a real implementation, this would trigger an update to the front-end site
            // For now, we'll just show a success message
            if (socialMedia.instagram || socialMedia.facebook || socialMedia.twitter) {
                showSuccessMessage('Social media icons will be added to the website footer with the provided links!');
            }
        }

        // Test API Connection
        window.testOrganizationAPI = async function() {
            console.log('Testing API connection...');

            try {
                // Test GET request
                const getResponse = await fetch(`/api/admin/organization?orgId=${currentOrgId}`);
                console.log('GET response status:', getResponse.status);

                if (getResponse.ok) {
                    const orgData = await getResponse.json();
                    console.log('GET response data:', orgData);
                    alert(`✅ API Connection Test Successful!\n\nOrganization: ${orgData.name || 'Unknown'}\nEmail: ${orgData.email || 'Unknown'}\nStatus: ${getResponse.status}`);
                } else {
                    const errorText = await getResponse.text();
                    console.error('GET error:', errorText);
                    alert(`❌ API Connection Test Failed!\n\nStatus: ${getResponse.status}\nError: ${errorText}`);
                }
            } catch (error) {
                console.error('API test error:', error);
                alert(`❌ API Connection Test Failed!\n\nError: ${error.message}`);
            }
        };

        // Settings Save Functions
        window.saveOrganizationSettings = async function() {
            console.log('Saving organization settings...');

            const orgData = {
                orgId: currentOrgId,
                name: document.getElementById('orgName').value,
                ein: document.getElementById('orgEIN').value,
                phone: document.getElementById('orgPhone').value,
                email: document.getElementById('orgEmail').value,
                address: document.getElementById('orgAddress').value,
                city: document.getElementById('orgCity').value,
                state: document.getElementById('orgState').value,
                zip: document.getElementById('orgZip').value,
                website: document.getElementById('orgWebsite').value,
                description: document.getElementById('orgDescription').value,
                aboutUs: document.getElementById('aboutUsContent').value,
                mission: document.getElementById('missionContent').value,
                vision: document.getElementById('visionContent').value,
                socialMedia: {
                    facebook: document.getElementById('facebookUrl').value,
                    instagram: document.getElementById('instagramUrl').value,
                    twitter: document.getElementById('twitterUrl').value
                }
            };

            try {
                console.log('Saving organization data:', orgData);

                // Save to organization API
                const orgResponse = await fetch('/api/admin/organization', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(orgData)
                });

                console.log('Organization API response status:', orgResponse.status);

                if (!orgResponse.ok) {
                    const orgError = await orgResponse.text();
                    console.error('Organization API error:', orgError);
                    throw new Error(`Organization API failed: ${orgResponse.status} - ${orgError}`);
                }

                // Update client data for frontend
                const clientResponse = await fetch('/api/admin/update-client-data', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(orgData)
                });

                console.log('Client data API response status:', clientResponse.status);

                if (!clientResponse.ok) {
                    const clientError = await clientResponse.text();
                    console.error('Client data API error:', clientError);
                    throw new Error(`Client data API failed: ${clientResponse.status} - ${clientError}`);
                }

                const clientResult = await clientResponse.json();
                console.log('Client data API result:', clientResult);

                showSuccessMessage('Organization settings saved successfully! Changes will appear on the website after refresh.');

            } catch (error) {
                console.error('Error saving organization settings:', error);
                alert(`Failed to save organization settings: ${error.message}`);
            }
        };

        window.saveBrandingSettings = async function() {
            console.log('Saving branding settings...');

            const brandingData = {
                orgId: currentOrgId,
                primaryColor: document.getElementById('primaryColorText').value,
                secondaryColor: document.getElementById('secondaryColorText').value,
                logo: document.getElementById('logoUrl').value,
                fonts: {
                    heading: document.getElementById('headingFont').value,
                    body: document.getElementById('bodyFont').value
                }
            };

            try {
                const response = await fetch('/api/admin/update-client-data', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(brandingData)
                });

                if (response.ok) {
                    showSuccessMessage('Branding settings saved successfully! Changes will appear on the website after refresh.');
                } else {
                    throw new Error('Failed to save branding settings');
                }
            } catch (error) {
                console.error('Error saving branding settings:', error);
                alert('Failed to save branding settings. Please try again.');
            }
        };

        window.saveSocialMediaSettings = async function() {
            console.log('Saving social media settings...');
            alert('Social media settings saved! (Feature coming soon)');
        };

        window.saveEmailSettings = async function() {
            console.log('Saving email settings...');
            alert('Email settings saved! (Feature coming soon)');
        };

        window.saveDomainSettings = async function() {
            console.log('Saving domain settings...');
            alert('Domain settings saved! (Feature coming soon)');
        };

        // Load organization data into settings form
        async function loadOrganizationSettings() {
            try {
                const response = await fetch(`/api/admin/organization?orgId=${currentOrgId}`);
                if (response.ok) {
                    const orgData = await response.json();

                    // Populate organization form fields
                    document.getElementById('orgName').value = orgData.name || '';
                    document.getElementById('orgEIN').value = orgData.ein || '';
                    document.getElementById('orgPhone').value = orgData.phone || '';
                    document.getElementById('orgEmail').value = orgData.email || '';
                    document.getElementById('orgAddress').value = orgData.address || '';
                    document.getElementById('orgCity').value = orgData.city || '';
                    document.getElementById('orgState').value = orgData.state || '';
                    document.getElementById('orgZip').value = orgData.zip || '';
                    document.getElementById('orgWebsite').value = orgData.website || '';
                    document.getElementById('orgDescription').value = orgData.description || '';

                    // Populate content fields
                    document.getElementById('aboutUsContent').value = orgData.about_us || '';
                    document.getElementById('missionContent').value = orgData.mission || '';
                    document.getElementById('visionContent').value = orgData.vision || '';

                    // Populate social media fields
                    document.getElementById('facebookUrl').value = orgData.facebook_url || '';
                    document.getElementById('instagramUrl').value = orgData.instagram_url || '';
                    document.getElementById('twitterUrl').value = orgData.twitter_url || '';

                    // Populate branding fields
                    if (orgData.primary_color) {
                        document.getElementById('primaryColorText').value = orgData.primary_color;
                        document.getElementById('primaryColorPicker').value = orgData.primary_color;
                    }
                    if (orgData.secondary_color) {
                        document.getElementById('secondaryColorText').value = orgData.secondary_color;
                        document.getElementById('secondaryColorPicker').value = orgData.secondary_color;
                    }
                    if (orgData.logo) {
                        document.getElementById('logoUrl').value = orgData.logo;
                    }

                    console.log('Organization settings loaded successfully');
                }
            } catch (error) {
                console.error('Error loading organization settings:', error);
            }
        }

        // Social Media Generator Functions
        let socialPosts = [];
        let shortenedUrls = {}; // Store shortened URLs for analytics

        // Platform toggle functionality
        function togglePlatformOptions(platform) {
            const checkbox = document.getElementById(`platform-${platform}`);
            const options = document.getElementById(`${platform}-options`);

            if (checkbox.checked) {
                options.classList.remove('hidden');
            } else {
                options.classList.add('hidden');
            }
        }

        // Get selected platforms and their configurations
        function getSelectedPlatforms() {
            const platforms = [];
            const checkboxes = document.querySelectorAll('.platform-checkbox:checked');

            checkboxes.forEach(checkbox => {
                const platform = checkbox.value;
                const config = {
                    platform: platform,
                    type: document.getElementById(`${platform}-type`)?.value || 'post',
                    style: document.getElementById(`${platform}-style`)?.value || 'general',
                    audience: document.getElementById(`${platform}-audience`)?.value || 'general',
                    focus: document.getElementById(`${platform}-focus`)?.value || 'general',
                    trend: document.getElementById(`${platform}-trend`)?.value || 'general',
                    link: document.getElementById(`${platform}-link`)?.value || ''
                };
                platforms.push(config);
            });

            return platforms;
        }

        // Load animals for social media selection
        async function loadAnimalsForSocialMedia() {
            try {
                // Load from Xano API
                let availableAnimals = [];

                if (currentOrg && currentOrg.isAdmin && currentOrgId === '8') {
                    // Admin can see all animals from all orgs
                    try {
                        const allAnimalsPromises = [3, 4, 5, 6, 7, 9].map(async (orgId) => {
                            try {
                                const response = await fetch(`/api/admin/animals?orgId=${orgId}`);
                                if (response.ok) {
                                    return await response.json();
                                }
                                return [];
                            } catch (error) {
                                return [];
                            }
                        });

                        const allAnimalsArrays = await Promise.all(allAnimalsPromises);
                        availableAnimals = allAnimalsArrays.flat();
                    } catch (error) {
                        console.warn('Failed to load all animals for admin, using fallback');
                        availableAnimals = Object.values(organizationAnimals).flat();
                    }
                } else {
                    // Regular org - load only their animals
                    try {
                        const response = await fetch(`/api/admin/animals?orgId=${currentOrgId}`);
                        if (response.ok) {
                            availableAnimals = await response.json();
                        } else {
                            availableAnimals = organizationAnimals[currentOrgId] || [];
                        }
                    } catch (error) {
                        availableAnimals = organizationAnimals[currentOrgId] || [];
                    }
                }

                const animalSelect = document.getElementById('selectedAnimal');

                // Clear existing options except the first one
                animalSelect.innerHTML = '<option value="">No specific animal</option>';

                // Add animals to select
                availableAnimals.forEach(animal => {
                    const option = document.createElement('option');
                    option.value = animal.id;
                    option.textContent = `${animal.name} - ${animal.species || 'Dog'} (${animal.breed || 'Mixed'})`;
                    option.dataset.animalData = JSON.stringify(animal);
                    animalSelect.appendChild(option);
                });

                // Also populate quick post pet selection
                const quickPostPet = document.getElementById('quickPostPet');
                if (quickPostPet) {
                    quickPostPet.innerHTML = '<option value="">No specific pet</option>';
                    availableAnimals.forEach(animal => {
                        const option = document.createElement('option');
                        option.value = animal.id;
                        option.textContent = `${animal.name} - ${animal.species || 'Dog'} (${animal.breed || 'Mixed'})`;
                        quickPostPet.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Error loading animals for social media:', error);
            }
        }

        // Handle post type change and quick post functionality
        document.addEventListener('DOMContentLoaded', function() {
            const postTypeSelect = document.getElementById('postType');
            const customPromptGroup = document.getElementById('customPromptGroup');

            if (postTypeSelect) {
                postTypeSelect.addEventListener('change', function() {
                    if (this.value === 'general') {
                        customPromptGroup.style.display = 'block';
                    } else {
                        customPromptGroup.style.display = 'none';
                    }
                });
            }

            // Quick post event listeners
            const quickPostContent = document.getElementById('quickPostContent');
            const quickHashtagInput = document.getElementById('quickHashtagInput');

            if (quickPostContent) {
                quickPostContent.addEventListener('input', function() {
                    updateCharacterCount();
                    updateQuickPostPreview();
                });
            }

            if (quickHashtagInput) {
                quickHashtagInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        addQuickHashtag();
                    }
                });
            }
        });

        // Generate social media content using AI
        async function generateSocialContent() {
            const generateBtn = document.getElementById('generateBtn');
            const generateBtnText = document.getElementById('generateBtnText');
            const generateBtnLoading = document.getElementById('generateBtnLoading');
            const contentPlaceholder = document.getElementById('contentPlaceholder');
            const generatedContentArea = document.getElementById('generatedContentArea');

            // Check if any platforms are selected
            const selectedPlatforms = getSelectedPlatforms();
            if (selectedPlatforms.length === 0) {
                alert('Please select at least one platform to generate content for.');
                return;
            }

            // Show loading state
            generateBtnText.classList.add('hidden');
            generateBtnLoading.classList.remove('hidden');
            generateBtn.disabled = true;

            try {
                // Get form data
                const postType = document.getElementById('postType').value;
                const tone = document.getElementById('tone').value;
                const customPrompt = document.getElementById('customPrompt').value;
                const selectedAnimalId = document.getElementById('selectedAnimal').value;

                // Get animal data if selected
                let animalData = null;
                if (selectedAnimalId) {
                    const selectedOption = document.querySelector(`#selectedAnimal option[value="${selectedAnimalId}"]`);
                    if (selectedOption && selectedOption.dataset.animalData) {
                        animalData = JSON.parse(selectedOption.dataset.animalData);
                    }
                }

                // Generate content for all selected platforms
                const platformResults = [];

                for (const platformConfig of selectedPlatforms) {
                    try {
                        const response = await fetch('/api/admin/generate-social-content', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                postType,
                                platform: platformConfig.platform,
                                platformConfig,
                                animalData,
                                customPrompt,
                                tone,
                                orgName: 'Happy Paws Dog Rescue' // TODO: Get from organization settings
                            })
                        });

                        const result = await response.json();

                        if (result.success) {
                            platformResults.push({
                                ...result,
                                platformConfig
                            });
                        } else {
                            console.error(`Failed to generate content for ${platformConfig.platform}:`, result.error);
                        }
                    } catch (error) {
                        console.error(`Error generating content for ${platformConfig.platform}:`, error);
                    }
                }

                if (platformResults.length > 0) {
                    // Display all platform results
                    displayMultiPlatformResults(platformResults, animalData);

                    // Show content area, hide placeholder
                    contentPlaceholder.classList.add('hidden');
                    generatedContentArea.classList.remove('hidden');

                    console.log('Multi-platform content generated successfully:', platformResults);
                } else {
                    throw new Error('Failed to generate content for any selected platforms');
                }

            } catch (error) {
                console.error('Error generating social content:', error);
                alert(`Failed to generate content: ${error.message}`);
            } finally {
                // Reset button state
                generateBtnText.classList.remove('hidden');
                generateBtnLoading.classList.add('hidden');
                generateBtn.disabled = false;
            }
        }

        // Save social media post
        function savePost(status = 'draft') {
            const content = document.getElementById('generatedContent').value;
            const hashtags = document.getElementById('generatedHashtags').value;
            const imagePrompt = document.getElementById('imagePrompt').value;
            const postType = document.getElementById('postType').value;
            const platform = document.getElementById('platform').value;

            if (!content.trim()) {
                alert('Please generate content first before saving.');
                return;
            }

            const post = {
                id: Date.now().toString(),
                title: `${postType.replace('_', ' ')} - ${platform}`,
                type: postType,
                platform: platform,
                content: content,
                hashtags: hashtags.split(',').map(tag => tag.trim()),
                imagePrompt: imagePrompt,
                status: status,
                createdDate: new Date().toISOString().split('T')[0],
                scheduledDate: null
            };

            // Add to posts array
            socialPosts.unshift(post);

            // Update stats and display
            updateSocialMediaStats();
            displaySavedPosts();

            // Show success message
            alert(`Post saved as ${status}!`);

            // Clear the form
            clearGeneratedContent();

            console.log('Post saved:', post);
        }

        // Copy content to clipboard
        async function copyToClipboard() {
            const content = document.getElementById('generatedContent').value;
            const hashtags = document.getElementById('generatedHashtags').value;

            if (!content.trim()) {
                alert('No content to copy. Please generate content first.');
                return;
            }

            const fullContent = `${content}\n\n${hashtags.split(',').map(tag => `#${tag.trim()}`).join(' ')}`;

            try {
                await navigator.clipboard.writeText(fullContent);
                alert('Content copied to clipboard!');
            } catch (error) {
                console.error('Failed to copy to clipboard:', error);
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = fullContent;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('Content copied to clipboard!');
            }
        }

        // Display animal images in the generated content area
        function displayAnimalImages(animalData) {
            const animalImagesSection = document.getElementById('animalImagesSection');
            const animalImagesGrid = document.getElementById('animalImagesGrid');

            if (!animalData) {
                animalImagesSection.classList.add('hidden');
                return;
            }

            // Collect all available images
            const images = [];
            if (animalData.image_url) images.push(animalData.image_url);
            if (animalData.images && Array.isArray(animalData.images)) {
                animalData.images.forEach(img => {
                    if (img && !images.includes(img)) images.push(img);
                });
            }

            if (images.length === 0) {
                animalImagesSection.classList.add('hidden');
                return;
            }

            // Create image grid HTML
            animalImagesGrid.innerHTML = images.map((img, index) => `
                <div class="relative group cursor-pointer" onclick="copyImageUrl('${img}')">
                    <img src="${img}" alt="${animalData.name}" class="w-full h-24 object-cover rounded border hover:border-blue-400 transition-colors">
                    <div class="absolute inset-0 bg-black bg-opacity-50 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity rounded flex items-center justify-center">
                        <span class="text-center">
                            <div class="font-medium">Copy URL</div>
                            <div class="text-xs opacity-75">${index === 0 ? 'Main Photo' : `Photo ${index + 1}`}</div>
                        </span>
                    </div>
                </div>
            `).join('');

            animalImagesSection.classList.remove('hidden');
        }

        // Display multi-platform results
        function displayMultiPlatformResults(platformResults, animalData) {
            const container = document.getElementById('platformResultsContainer');

            // Display animal images
            displayAnimalImages(animalData);

            // Generate platform-specific content displays
            container.innerHTML = platformResults.map(result => {
                const platform = result.platform;
                const config = result.platformConfig;
                const platformColors = {
                    facebook: 'bg-blue-50 border-blue-200',
                    instagram: 'bg-pink-50 border-pink-200',
                    twitter: 'bg-blue-50 border-blue-200',
                    linkedin: 'bg-blue-50 border-blue-200',
                    tiktok: 'bg-black text-white border-gray-600',
                    youtube: 'bg-red-50 border-red-200'
                };

                const platformIcons = {
                    facebook: '📘',
                    instagram: '📷',
                    twitter: '🐦',
                    linkedin: '💼',
                    tiktok: '🎵',
                    youtube: '📺'
                };

                return `
                    <div class="border rounded-lg p-4 ${platformColors[platform] || 'bg-gray-50 border-gray-200'}">
                        <div class="flex items-center justify-between mb-3">
                            <h4 class="font-semibold text-lg flex items-center gap-2">
                                <span class="text-2xl">${platformIcons[platform]}</span>
                                ${platform.charAt(0).toUpperCase() + platform.slice(1)} ${config.type}
                            </h4>
                            <div class="flex gap-2">
                                <button onclick="copyPlatformContent('${platform}', '${result.content.replace(/'/g, "\\'")}', '${result.hashtags.join(' #')}')"
                                        class="btn-sm bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700">
                                    📋 Copy
                                </button>
                                <button onclick="optimizeMediaForPlatform('${platform}')"
                                        class="btn-sm bg-purple-600 text-white px-3 py-1 rounded text-sm hover:bg-purple-700">
                                    🎨 Optimize Media
                                </button>
                            </div>
                        </div>

                        <div class="space-y-3">
                            <div>
                                <label class="text-sm font-medium text-gray-700">Content:</label>
                                <div class="bg-white p-3 rounded border mt-1">
                                    <p class="text-gray-800">${result.content}</p>
                                </div>
                            </div>

                            <div>
                                <label class="text-sm font-medium text-gray-700">Hashtags:</label>
                                <div class="flex flex-wrap gap-1 mt-1">
                                    ${result.hashtags.map(tag => `<span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm">#${tag}</span>`).join('')}
                                </div>
                            </div>

                            ${config.link ? `
                                <div>
                                    <label class="text-sm font-medium text-gray-700">Link:</label>
                                    <div class="mt-1">
                                        <input type="text" value="${config.link}" class="form-input text-sm" readonly>
                                    </div>
                                </div>
                            ` : ''}

                            <div class="text-xs text-gray-600">
                                <strong>Platform specs:</strong> ${config.type} • ${config.style || config.audience || config.focus || config.trend || 'Standard'}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Copy platform-specific content
        async function copyPlatformContent(platform, content, hashtags) {
            try {
                const fullContent = `${content}\n\n${hashtags}`;
                await navigator.clipboard.writeText(fullContent);
                showSuccessMessage(`${platform.charAt(0).toUpperCase() + platform.slice(1)} content copied to clipboard!`);
            } catch (error) {
                console.error('Failed to copy content:', error);
                alert('Failed to copy content. Please try again.');
            }
        }

        // Copy image URL to clipboard
        async function copyImageUrl(imageUrl) {
            try {
                await navigator.clipboard.writeText(imageUrl);
                showSuccessMessage('Image URL copied to clipboard!');
            } catch (error) {
                console.error('Failed to copy image URL:', error);
                alert('Failed to copy image URL. Please try again.');
            }
        }

        // Show success message helper
        function showSuccessMessage(message) {
            const tempMessage = document.createElement('div');
            tempMessage.className = 'fixed top-4 right-4 bg-green-600 text-white px-4 py-2 rounded shadow-lg z-50';
            tempMessage.textContent = message;
            document.body.appendChild(tempMessage);

            setTimeout(() => {
                if (document.body.contains(tempMessage)) {
                    document.body.removeChild(tempMessage);
                }
            }, 3000);
        }

        // URL Shortener functionality
        async function shortenUrl() {
            const originalUrl = document.getElementById('originalUrl').value;
            const shortenedUrlField = document.getElementById('shortenedUrl');
            const urlAnalytics = document.getElementById('urlAnalytics');

            if (!originalUrl) {
                alert('Please enter a URL to shorten');
                return;
            }

            try {
                // Simple URL shortener simulation (in production, use a real service like Bitly)
                const shortId = Math.random().toString(36).substring(2, 8);
                const shortenedUrl = `https://happypaws.ly/${shortId}`;

                // Store for analytics
                shortenedUrls[shortId] = {
                    originalUrl: originalUrl,
                    shortenedUrl: shortenedUrl,
                    clicks: 0,
                    created: new Date().toISOString()
                };

                shortenedUrlField.value = shortenedUrl;
                document.getElementById('clickCount').textContent = '0 clicks';
                document.getElementById('urlCreated').textContent = `Created: ${new Date().toLocaleDateString()}`;
                urlAnalytics.classList.remove('hidden');

                showSuccessMessage('URL shortened successfully!');
            } catch (error) {
                console.error('Error shortening URL:', error);
                alert('Failed to shorten URL. Please try again.');
            }
        }

        // Media optimization for different platforms
        function optimizeMediaForPlatform(platform) {
            const animalImages = document.querySelectorAll('#animalImagesGrid img');
            if (animalImages.length === 0) {
                alert('No animal images available to optimize. Please select an animal first to load their photos.');
                return;
            }

            // Enhanced platform specifications with multiple format options
            const platformSpecs = {
                facebook: [
                    { width: 1200, height: 630, format: 'JPG', name: 'Facebook Post', type: 'Landscape' },
                    { width: 1080, height: 1080, format: 'JPG', name: 'Facebook Square', type: 'Square' },
                    { width: 1080, height: 1920, format: 'JPG', name: 'Facebook Story', type: 'Vertical' }
                ],
                instagram: [
                    { width: 1080, height: 1080, format: 'JPG', name: 'Instagram Post', type: 'Square' },
                    { width: 1080, height: 1920, format: 'JPG', name: 'Instagram Story', type: 'Vertical' },
                    { width: 1080, height: 566, format: 'JPG', name: 'Instagram Landscape', type: 'Landscape' }
                ],
                twitter: [
                    { width: 1200, height: 675, format: 'JPG', name: 'Twitter Card', type: 'Landscape' },
                    { width: 1080, height: 1080, format: 'JPG', name: 'Twitter Square', type: 'Square' }
                ],
                linkedin: [
                    { width: 1200, height: 627, format: 'JPG', name: 'LinkedIn Post', type: 'Landscape' },
                    { width: 1080, height: 1080, format: 'JPG', name: 'LinkedIn Square', type: 'Square' }
                ],
                tiktok: [
                    { width: 1080, height: 1920, format: 'MP4', name: 'TikTok Video', type: 'Vertical' },
                    { width: 1080, height: 1920, format: 'JPG', name: 'TikTok Cover', type: 'Vertical' }
                ],
                youtube: [
                    { width: 1280, height: 720, format: 'JPG', name: 'YouTube Thumbnail', type: 'Landscape' },
                    { width: 1080, height: 1920, format: 'JPG', name: 'YouTube Short', type: 'Vertical' }
                ]
            };

            const specs = platformSpecs[platform];
            if (!specs) return;

            // Show loading state
            const optimizedMediaContainer = document.getElementById('optimizedMediaContainer');
            const optimizedMediaGrid = document.getElementById('optimizedMediaGrid');

            optimizedMediaContainer.innerHTML = '<div class="text-center py-4"><div class="text-gray-500">🔄 Optimizing images for ' + platform + '...</div></div>';
            optimizedMediaGrid.classList.remove('hidden');

            // Simulate processing time for realistic feel
            setTimeout(() => {
                const optimizedHtml = Array.from(animalImages).flatMap((img, imgIndex) =>
                    specs.map((spec, specIndex) => `
                        <div class="border rounded-lg p-3 bg-white shadow-sm hover:shadow-md transition-shadow">
                            <div class="flex items-center justify-between mb-2">
                                <div class="text-xs font-medium text-gray-700">${spec.name}</div>
                                <div class="text-xs px-2 py-1 rounded ${
                                    spec.type === 'Square' ? 'bg-blue-100 text-blue-700' :
                                    spec.type === 'Landscape' ? 'bg-green-100 text-green-700' :
                                    'bg-purple-100 text-purple-700'
                                }">${spec.type}</div>
                            </div>
                            <div class="relative group">
                                <img src="${img.src}" alt="Optimized for ${platform}"
                                     class="w-full h-20 object-cover rounded border hover:border-blue-400 transition-colors">
                                <div class="absolute inset-0 bg-black bg-opacity-50 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity rounded flex items-center justify-center">
                                    <span class="text-center">
                                        <div class="font-medium">Click to Copy</div>
                                        <div class="text-xs">${spec.width}×${spec.height}</div>
                                    </span>
                                </div>
                            </div>
                            <div class="text-xs text-gray-500 mt-2 text-center">
                                ${spec.width}×${spec.height} ${spec.format}
                            </div>
                            <button onclick="copyOptimizedImageUrl('${img.src}', '${spec.width}', '${spec.height}', '${spec.format}', '${platform}')"
                                    class="text-xs bg-gradient-to-r from-blue-500 to-purple-600 text-white px-2 py-1 rounded mt-2 w-full hover:from-blue-600 hover:to-purple-700 transition-colors">
                                📋 Copy Optimized URL
                            </button>
                        </div>
                    `)
                ).join('');

                optimizedMediaContainer.innerHTML = optimizedHtml;

                showSuccessMessage(`✨ ${animalImages.length} images optimized for ${platform} in ${specs.length} formats!`);
            }, 800); // Simulate processing time
        }

        // Copy optimized image URL with metadata
        function copyOptimizedImageUrl(originalUrl, width, height, format, platform) {
            // In production, this would be the actual optimized image URL
            const optimizedUrl = `${originalUrl}?w=${width}&h=${height}&f=${format}&platform=${platform}`;

            navigator.clipboard.writeText(optimizedUrl).then(() => {
                showSuccessMessage(`📋 Optimized ${platform} image URL copied! (${width}×${height} ${format})`);
            }).catch(err => {
                console.error('Failed to copy optimized URL:', err);
                alert('Failed to copy URL. Please try again.');
            });
        }

        // Optimize media for all selected platforms
        function optimizeAllMedia() {
            const selectedPlatforms = getSelectedPlatforms();
            const animalImages = document.querySelectorAll('#animalImagesGrid img');

            if (selectedPlatforms.length === 0) {
                alert('Please select at least one platform first.');
                return;
            }

            if (animalImages.length === 0) {
                alert('No animal images available to optimize. Please select an animal first to load their photos.');
                return;
            }

            // Show loading state
            const optimizedMediaContainer = document.getElementById('optimizedMediaContainer');
            const optimizedMediaGrid = document.getElementById('optimizedMediaGrid');

            optimizedMediaContainer.innerHTML = `
                <div class="text-center py-8">
                    <div class="text-2xl mb-2">🔄</div>
                    <div class="text-gray-600 font-medium">Optimizing images for ${selectedPlatforms.length} platforms...</div>
                    <div class="text-sm text-gray-500 mt-1">This may take a moment</div>
                </div>
            `;
            optimizedMediaGrid.classList.remove('hidden');

            // Simulate processing time for all platforms
            setTimeout(() => {
                let allOptimizedHtml = '';
                let totalOptimizations = 0;

                selectedPlatforms.forEach(platformConfig => {
                    const platform = platformConfig.platform;

                    // Platform specifications (same as in optimizeMediaForPlatform)
                    const platformSpecs = {
                        facebook: [
                            { width: 1200, height: 630, format: 'JPG', name: 'Facebook Post', type: 'Landscape' },
                            { width: 1080, height: 1080, format: 'JPG', name: 'Facebook Square', type: 'Square' },
                            { width: 1080, height: 1920, format: 'JPG', name: 'Facebook Story', type: 'Vertical' }
                        ],
                        instagram: [
                            { width: 1080, height: 1080, format: 'JPG', name: 'Instagram Post', type: 'Square' },
                            { width: 1080, height: 1920, format: 'JPG', name: 'Instagram Story', type: 'Vertical' },
                            { width: 1080, height: 566, format: 'JPG', name: 'Instagram Landscape', type: 'Landscape' }
                        ],
                        twitter: [
                            { width: 1200, height: 675, format: 'JPG', name: 'Twitter Card', type: 'Landscape' },
                            { width: 1080, height: 1080, format: 'JPG', name: 'Twitter Square', type: 'Square' }
                        ],
                        linkedin: [
                            { width: 1200, height: 627, format: 'JPG', name: 'LinkedIn Post', type: 'Landscape' },
                            { width: 1080, height: 1080, format: 'JPG', name: 'LinkedIn Square', type: 'Square' }
                        ],
                        tiktok: [
                            { width: 1080, height: 1920, format: 'MP4', name: 'TikTok Video', type: 'Vertical' },
                            { width: 1080, height: 1920, format: 'JPG', name: 'TikTok Cover', type: 'Vertical' }
                        ],
                        youtube: [
                            { width: 1280, height: 720, format: 'JPG', name: 'YouTube Thumbnail', type: 'Landscape' },
                            { width: 1080, height: 1920, format: 'JPG', name: 'YouTube Short', type: 'Vertical' }
                        ]
                    };

                    const specs = platformSpecs[platform];
                    if (!specs) return;

                    // Platform header
                    const platformColors = {
                        facebook: 'bg-blue-50 border-blue-200 text-blue-900',
                        instagram: 'bg-pink-50 border-pink-200 text-pink-900',
                        twitter: 'bg-sky-50 border-sky-200 text-sky-900',
                        linkedin: 'bg-indigo-50 border-indigo-200 text-indigo-900',
                        tiktok: 'bg-gray-50 border-gray-200 text-gray-900',
                        youtube: 'bg-red-50 border-red-200 text-red-900'
                    };

                    allOptimizedHtml += `
                        <div class="mb-6">
                            <div class="border rounded-lg p-3 ${platformColors[platform] || 'bg-gray-50 border-gray-200 text-gray-900'} mb-3">
                                <h4 class="font-medium capitalize">📱 ${platform} Optimized Images</h4>
                                <p class="text-xs mt-1 opacity-75">${specs.length} formats • ${animalImages.length} images</p>
                            </div>
                            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                    `;

                    // Generate optimized images for this platform
                    Array.from(animalImages).forEach((img, imgIndex) => {
                        specs.forEach((spec, specIndex) => {
                            totalOptimizations++;
                            allOptimizedHtml += `
                                <div class="border rounded-lg p-3 bg-white shadow-sm hover:shadow-md transition-shadow">
                                    <div class="flex items-center justify-between mb-2">
                                        <div class="text-xs font-medium text-gray-700">${spec.name}</div>
                                        <div class="text-xs px-2 py-1 rounded ${
                                            spec.type === 'Square' ? 'bg-blue-100 text-blue-700' :
                                            spec.type === 'Landscape' ? 'bg-green-100 text-green-700' :
                                            'bg-purple-100 text-purple-700'
                                        }">${spec.type}</div>
                                    </div>
                                    <div class="relative group">
                                        <img src="${img.src}" alt="Optimized for ${platform}"
                                             class="w-full h-20 object-cover rounded border hover:border-blue-400 transition-colors">
                                        <div class="absolute inset-0 bg-black bg-opacity-50 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity rounded flex items-center justify-center">
                                            <span class="text-center">
                                                <div class="font-medium">Click to Copy</div>
                                                <div class="text-xs">${spec.width}×${spec.height}</div>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="text-xs text-gray-500 mt-2 text-center">
                                        ${spec.width}×${spec.height} ${spec.format}
                                    </div>
                                    <button onclick="copyOptimizedImageUrl('${img.src}', '${spec.width}', '${spec.height}', '${spec.format}', '${platform}')"
                                            class="text-xs bg-gradient-to-r from-blue-500 to-purple-600 text-white px-2 py-1 rounded mt-2 w-full hover:from-blue-600 hover:to-purple-700 transition-colors">
                                        📋 Copy URL
                                    </button>
                                </div>
                            `;
                        });
                    });

                    allOptimizedHtml += `
                            </div>
                        </div>
                    `;
                });

                optimizedMediaContainer.innerHTML = allOptimizedHtml;

                showSuccessMessage(`🎉 ${totalOptimizations} optimized images generated for ${selectedPlatforms.length} platforms!`);
            }, 1200); // Longer processing time for multiple platforms
        }

        // Copy all platform content
        async function copyAllToClipboard() {
            const platformResults = document.querySelectorAll('#platformResultsContainer > div');
            if (platformResults.length === 0) {
                alert('No content to copy. Please generate content first.');
                return;
            }

            let allContent = '';
            platformResults.forEach((result, index) => {
                const platform = result.querySelector('h4').textContent;
                const content = result.querySelector('.bg-white p').textContent;
                const hashtags = Array.from(result.querySelectorAll('.bg-blue-100')).map(tag => tag.textContent).join(' ');

                allContent += `\n=== ${platform} ===\n${content}\n${hashtags}\n`;
            });

            try {
                await navigator.clipboard.writeText(allContent);
                showSuccessMessage('All platform content copied to clipboard!');
            } catch (error) {
                console.error('Failed to copy all content:', error);
                alert('Failed to copy content. Please try again.');
            }
        }

        // Save all posts
        function saveAllPosts(status = 'draft') {
            const platformResults = document.querySelectorAll('#platformResultsContainer > div');
            if (platformResults.length === 0) {
                alert('No content to save. Please generate content first.');
                return;
            }

            let savedCount = 0;
            platformResults.forEach((result) => {
                const platform = result.querySelector('h4').textContent;
                const content = result.querySelector('.bg-white p').textContent;
                const hashtags = Array.from(result.querySelectorAll('.bg-blue-100')).map(tag => tag.textContent.replace('#', ''));

                const post = {
                    id: Date.now() + savedCount,
                    title: `Multi-platform ${platform}`,
                    type: 'multi_platform',
                    platform: platform.toLowerCase(),
                    content: content,
                    hashtags: hashtags,
                    status: status,
                    createdDate: new Date().toISOString().split('T')[0],
                    scheduledDate: null
                };

                socialPosts.push(post);
                savedCount++;
            });

            showSuccessMessage(`${savedCount} posts saved as ${status}!`);
            updateSocialMediaStats();
        }

        // Schedule all posts
        function scheduleAllPosts() {
            // This would integrate with a scheduling service in production
            alert('Post scheduling feature coming soon! This would integrate with social media management tools.');
        }

        // Quick Post Template System
        const postTemplates = {
            new_arrival: {
                title: "New Arrival: {petName}",
                content: "🐕 Meet {petName}! This {age} {breed} just arrived at our shelter and is looking for their forever home. {petName} is {personality} and would love to find a family who can give them all the love they deserve. Could that be you? 💕\n\nCome meet {petName} today or share this post to help us find them a home!",
                hashtags: ["NewArrival", "AdoptDontShop", "RescueDog", "ForeverHome", "AdoptMe"]
            },
            adoption_success: {
                title: "Adoption Success: {petName}",
                content: "🎉 ADOPTED! We're thrilled to share that {petName} has found their perfect family! After {timeInCare} in our care, this sweet {breed} is now living their best life with their new humans. \n\nThank you to everyone who shared, liked, and helped spread the word. This is what rescue is all about! ❤️",
                hashtags: ["Adopted", "SuccessStory", "HappyEnding", "RescueSuccess", "ForeverHome"]
            },
            fundraiser: {
                title: "Urgent: {campaignName} Fundraiser",
                content: "🚨 We need your help! Our {campaignName} campaign is at {percentage}% of our goal, and we still need ${remainingAmount} to reach our target.\n\nEvery dollar helps us provide medical care, food, and shelter for animals in need. Can you help us reach our goal? Even $5 makes a difference! 🙏",
                hashtags: ["Fundraiser", "HelpAnimals", "Donate", "RescueFunding", "EveryDollarCounts"]
            },
            volunteer_need: {
                title: "Volunteers Needed!",
                content: "🙌 We're looking for amazing volunteers like YOU! Whether you have 2 hours or 20 hours a week, there's a way you can help our furry friends.\n\nWe need help with:\n• Dog walking and socialization\n• Cat care and enrichment\n• Administrative tasks\n• Event support\n\nReady to make a difference? Contact us today!",
                hashtags: ["Volunteer", "MakeADifference", "HelpAnimals", "CommunitySupport", "JoinOurTeam"]
            },
            success_story: {
                title: "Success Story: {petName}",
                content: "💕 Success Story Alert! {petName} is living their best life with their new family! Look at that happy face! 😊\n\nFrom scared and uncertain to confident and loved - this is the transformation that rescue makes possible. Thank you to {petName}'s amazing family for giving them the second chance they deserved!",
                hashtags: ["SuccessStory", "RescueTransformation", "HappyEnding", "SecondChances", "LoveWins"]
            },
            event: {
                title: "{eventName} - Join Us!",
                content: "📅 Mark your calendars! Join us for {eventName} on {date} at {location}. \n\nCome meet our amazing animals, learn about our rescue work, and see how you can help! There will be:\n• Adoptable pets\n• Fun activities\n• Refreshments\n• Great company!\n\nSee you there! 🎉",
                hashtags: ["Event", "CommunityEvent", "AdoptionEvent", "AnimalRescue", "JoinUs"]
            }
        };

        let selectedTemplate = null;
        let quickPostHashtags = [];

        // Select a template and show the form
        function selectTemplate(templateType) {
            selectedTemplate = templateType;
            const template = postTemplates[templateType];

            // Show the form
            document.getElementById('quickPostForm').classList.remove('hidden');

            // Populate form fields
            document.getElementById('quickPostTitle').value = template.title;
            document.getElementById('quickPostType').value = templateType;
            document.getElementById('quickPostContent').value = template.content;

            // Set hashtags
            quickPostHashtags = [...template.hashtags];
            updateQuickPostHashtags();
            updateQuickPostPreview();
            updateCharacterCount();

            // Scroll to form
            document.getElementById('quickPostForm').scrollIntoView({ behavior: 'smooth' });
        }

        // Update hashtags display
        function updateQuickPostHashtags() {
            const container = document.getElementById('quickPostHashtags');
            container.innerHTML = quickPostHashtags.map(tag => `
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                    #${tag}
                    <button type="button" onclick="removeQuickHashtag('${tag}')" class="ml-1 text-blue-600 hover:text-blue-800">×</button>
                </span>
            `).join('');

            updateQuickPostPreview();
        }

        // Add hashtag
        function addQuickHashtag() {
            const input = document.getElementById('quickHashtagInput');
            const hashtag = input.value.trim().replace('#', '');

            if (hashtag && !quickPostHashtags.includes(hashtag)) {
                quickPostHashtags.push(hashtag);
                updateQuickPostHashtags();
                input.value = '';
            }
        }

        // Remove hashtag
        function removeQuickHashtag(hashtag) {
            quickPostHashtags = quickPostHashtags.filter(tag => tag !== hashtag);
            updateQuickPostHashtags();
        }

        // Update character count
        function updateCharacterCount() {
            const content = document.getElementById('quickPostContent').value;
            const charCount = content.length;
            document.getElementById('quickPostCharCount').textContent = charCount;

            // Color coding for character limits
            const countElement = document.getElementById('quickPostCharCount');
            if (charCount > 280) {
                countElement.className = 'text-red-600 font-medium';
            } else if (charCount > 240) {
                countElement.className = 'text-yellow-600 font-medium';
            } else {
                countElement.className = 'text-gray-500';
            }
        }

        // Update preview
        function updateQuickPostPreview() {
            const content = document.getElementById('quickPostContent').value;
            const hashtags = quickPostHashtags.map(tag => `#${tag}`).join(' ');

            document.getElementById('quickPostPreview').textContent = content || 'Select a template to see preview...';
            document.getElementById('quickPostHashtagsPreview').textContent = hashtags;
        }

        // Cancel quick post
        function cancelQuickPost() {
            document.getElementById('quickPostForm').classList.add('hidden');
            selectedTemplate = null;
            quickPostHashtags = [];

            // Clear form
            document.getElementById('quickPostTitle').value = '';
            document.getElementById('quickPostContent').value = '';
            document.getElementById('quickHashtagInput').value = '';
            updateQuickPostHashtags();
            updateQuickPostPreview();
        }

        // Save quick post
        function saveQuickPost() {
            const title = document.getElementById('quickPostTitle').value;
            const content = document.getElementById('quickPostContent').value;
            const platform = document.getElementById('quickPostPlatform').value;
            const petId = document.getElementById('quickPostPet').value;

            if (!title || !content) {
                alert('Please fill in the title and content fields.');
                return;
            }

            // Create post object
            const post = {
                id: Date.now(),
                title: title,
                type: selectedTemplate,
                platform: platform,
                content: content,
                hashtags: quickPostHashtags,
                petId: petId,
                status: 'draft',
                createdDate: new Date().toISOString().split('T')[0],
                scheduledDate: null
            };

            // Add to posts array
            socialPosts.push(post);

            // Show success message
            showSuccessMessage(`✅ Quick post "${title}" saved as draft!`);

            // Update stats
            updateSocialMediaStats();

            // Clear form
            cancelQuickPost();
        }

        // Clear generated content
        function clearGeneratedContent() {
            document.getElementById('platformResultsContainer').innerHTML = '';
            document.getElementById('animalImagesSection').classList.add('hidden');
            document.getElementById('animalImagesGrid').innerHTML = '';
            document.getElementById('optimizedMediaGrid').classList.add('hidden');
            document.getElementById('originalUrl').value = '';
            document.getElementById('shortenedUrl').value = '';
            document.getElementById('urlAnalytics').classList.add('hidden');
            document.getElementById('contentPlaceholder').classList.remove('hidden');
            document.getElementById('generatedContentArea').classList.add('hidden');

            // Uncheck all platform checkboxes
            document.querySelectorAll('.platform-checkbox').forEach(checkbox => {
                checkbox.checked = false;
            });

            // Hide all platform options
            document.querySelectorAll('.platform-options').forEach(options => {
                options.classList.add('hidden');
            });
        }

        // Update social media statistics
        function updateSocialMediaStats() {
            const totalPosts = socialPosts.length;
            const publishedPosts = socialPosts.filter(post => post.status === 'published').length;
            const scheduledPosts = socialPosts.filter(post => post.status === 'scheduled').length;
            const draftPosts = socialPosts.filter(post => post.status === 'draft').length;

            document.getElementById('totalPosts').textContent = totalPosts;
            document.getElementById('publishedPosts').textContent = publishedPosts;
            document.getElementById('scheduledPosts').textContent = scheduledPosts;
            document.getElementById('draftPosts').textContent = draftPosts;
        }

        // Display saved posts
        function displaySavedPosts() {
            const postsList = document.getElementById('socialPostsList');

            if (socialPosts.length === 0) {
                postsList.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <div class="text-4xl mb-2">📝</div>
                        <p>No posts created yet. Generate your first post above!</p>
                    </div>
                `;
                return;
            }

            postsList.innerHTML = socialPosts.map(post => `
                <div class="border border-gray-200 rounded-lg p-4">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="text-sm font-medium text-gray-900">${post.title}</span>
                                <span class="px-2 py-1 text-xs rounded-full ${getStatusBadgeClass(post.status)}">${post.status}</span>
                                <span class="px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full">${post.platform}</span>
                            </div>
                            <p class="text-sm text-gray-600 mb-2">${post.content.substring(0, 150)}${post.content.length > 150 ? '...' : ''}</p>
                            <div class="flex items-center space-x-4 text-xs text-gray-500">
                                <span>Created: ${post.createdDate}</span>
                                <span>Hashtags: ${post.hashtags.length}</span>
                            </div>
                        </div>
                        <div class="flex space-x-2 ml-4">
                            <button onclick="copyPostToClipboard('${post.id}')" class="text-blue-600 hover:text-blue-800 text-sm">Copy</button>
                            <button onclick="deletePost('${post.id}')" class="text-red-600 hover:text-red-800 text-sm">Delete</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Get status badge CSS class
        function getStatusBadgeClass(status) {
            switch (status) {
                case 'published': return 'bg-green-100 text-green-800';
                case 'scheduled': return 'bg-yellow-100 text-yellow-800';
                case 'draft': return 'bg-gray-100 text-gray-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        // Copy specific post to clipboard
        function copyPostToClipboard(postId) {
            const post = socialPosts.find(p => p.id === postId);
            if (!post) return;

            const fullContent = `${post.content}\n\n${post.hashtags.map(tag => `#${tag}`).join(' ')}`;

            navigator.clipboard.writeText(fullContent).then(() => {
                alert('Post copied to clipboard!');
            }).catch(error => {
                console.error('Failed to copy:', error);
                alert('Failed to copy post to clipboard.');
            });
        }

        // Delete post
        function deletePost(postId) {
            if (confirm('Are you sure you want to delete this post?')) {
                socialPosts = socialPosts.filter(p => p.id !== postId);
                displaySavedPosts();
                updateSocialMediaStats();
            }
        }

        // Load social media data when tab is opened
        function loadSocialMediaData() {
            loadAnimalsForSocialMedia();
            updateSocialMediaStats();
            displaySavedPosts();
        }

        // Global functions to make them accessible from onclick handlers
        window.showDashboardTab = showDashboardTab;
        window.showSettingsSection = showSettingsSection;
        window.handleCSVUpload = handleCSVUpload;
        window.downloadCSVTemplate = downloadCSVTemplate;
        window.processCSVUpload = processCSVUpload;
    </script>
</body>
</html>
