# Admin Setup Guide

This guide explains how the admin interface is set up for all generated sites and how to access it.

## 🎯 Overview

Every site generated by this template system includes a fully functional admin interface powered by **Decap CMS** (formerly Netlify CMS). This allows you to manage content through a web interface without needing to edit code directly.

## 📁 Admin Files Structure

Each site includes these admin files:

```
your-site/
├── public/
│   └── admin/
│       ├── index.html          # Admin interface entry point
│       ├── config.yml          # CMS configuration
│       └── decap-preview-styles.css  # Preview styling
└── src/
    └── layouts/
        └── BaseLayout.astro    # Includes Netlify Identity widget
```

## 🔧 Automatic Setup

The site generation scripts automatically ensure:

1. **Admin Interface Files**: Creates `admin/index.html` with Decap CMS
2. **Authentication Setup**: Adds Netlify Identity widget to BaseLayout.astro
3. **Configuration**: Includes default CMS configuration
4. **Styling**: Adds preview styles for the admin interface

## 🌐 Accessing the Admin

### For Individual Sites

**Mission Bay Puppy Rescue:**
- URL: `http://localhost:4322/admin/`
- Or: `http://localhost:4322/admin/index.html`

**Happy Paws Site:**
- URL: `http://localhost:4323/admin/`
- Or: `http://localhost:4323/admin/index.html`

### For Multi-Organization Sites

Each organization gets its own admin interface:

- **Happy Paws**: `http://localhost:4330/admin/`
- **Furry Friends**: `http://localhost:4331/admin/`
- **Paws & Hearts**: `http://localhost:4332/admin/`
- **Second Chance**: `http://localhost:4333/admin/`
- **Loving Tails**: `http://localhost:4334/admin/`
- **Rescue Rangers**: `http://localhost:4335/admin/`

## 🔐 Authentication

The admin uses **DecapBridge** authentication:

1. **Development**: Admin interface loads locally for testing
2. **Production**: Requires Netlify Identity setup for live sites

## 📝 What You Can Manage

Through the admin interface, you can:

- **Blog Posts**: Create, edit, and delete blog content
- **Media Files**: Upload and manage images
- **Content**: Edit page content and metadata
- **Settings**: Configure site-wide settings

## 🛠️ Technical Details

### Netlify Identity Widget

Added to every BaseLayout.astro:

```html
<!-- In <head> -->
<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

<!-- Before </body> -->
<script is:inline>
  if (window.netlifyIdentity) {
    window.netlifyIdentity.on("init", user => {
      if (!user) {
        window.netlifyIdentity.on("login", () => {
          document.location.href = "/admin/";
        });
      }
    });
  }
</script>
```

### Admin Index.html

Each admin directory contains:

```html
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Site Name - Admin</title>
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  </head>
  <body>
    <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
    <!-- Authentication handling -->
  </body>
</html>
```

## 🚀 Generation Scripts

All generation scripts now include admin setup:

### process-template.js
- Copies admin files
- Ensures admin/index.html exists
- Creates default config.yml if missing

### generate-org-site.js
- Sets up admin for single organization sites
- Updates BaseLayout.astro with Netlify Identity
- Creates organization-specific admin interface

### generate-multi-org-sites.js
- Sets up admin for all organization sites
- Configures unique admin interfaces per organization
- Ensures proper authentication setup

## ✅ Verification Checklist

When creating a new site, verify:

- [ ] `public/admin/index.html` exists
- [ ] `public/admin/config.yml` exists
- [ ] BaseLayout.astro includes Netlify Identity widget
- [ ] Admin interface loads at `/admin/`
- [ ] Authentication flow works (for production)

## 🔧 Troubleshooting

### Admin Page Not Loading
1. Check if `admin/index.html` exists
2. Verify development server is running
3. Try accessing `/admin/index.html` directly

### Authentication Issues
1. Ensure Netlify Identity widget is in BaseLayout.astro
2. Check browser console for JavaScript errors
3. Verify DecapBridge configuration in config.yml

### Missing Admin Files
1. Re-run the generation script
2. Check if files were copied correctly
3. Manually create missing files using templates above

## 📚 Additional Resources

- [Decap CMS Documentation](https://decapcms.org/docs/)
- [Netlify Identity Documentation](https://docs.netlify.com/visitor-access/identity/)
- [DecapBridge Setup Guide](https://decapbridge.com/)

---

**Note**: This admin setup is automatically included in all generated sites. No manual configuration is required for basic functionality.
